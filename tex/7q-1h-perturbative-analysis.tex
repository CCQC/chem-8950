\documentclass[11pt]{article}
\usepackage[cm]{fullpage}
%%AVC PACKAGES
\usepackage{avcgreek}
\usepackage{avcfonts}
\usepackage{avcmath}
\usepackage[numberby=section,skip=9pt plus 2pt minus 7pt]{avcthm}
\usepackage{qcmacros}
\usepackage{goldstone}
%%MACROS FOR THIS DOCUMENT
\numberwithin{equation}{section}
\usepackage[
  margin=1.5cm,
  includefoot,
  footskip=30pt,
  headsep=0.2cm,headheight=1.3cm
]{geometry}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{Quiz 7, Handout 1: Perturbative analysis}
\fancyfoot[CE,CO]{\thepage}
\usepackage{url}
\makeatother
\newcommand{\resolventline}[2][1]{
  \tikz[overlay]{
      \draw[thick,flexdotted] (0,-1ex) to ++(0,#1*4.5ex) node[above,inner sep=1pt] {#2};
  }
}

\begin{document}

\setlength{\abovedisplayskip}{3pt}
\setlength{\belowdisplayskip}{3pt}



\setcounter{section}{6}
\section{Perturbative analysis}


\begin{dfn}
\thmtitle{Correct to order $p$}
Let
$
  X\ord{p^-}
$
and
$
  X\ord{p^+}
$
denote
$
  X\ord{0}
+
  X\ord{1}
+
  \cd
+
  X\ord{p}
$
and
$
  X\ord{p}
+
  X\ord{p+1}
+
  \cd
+
  X\ord{\infty}
$.
We say that an approximation to $X$ is \textit{correct to order $p$} if it contains all of the contributions in $X\ord{p^-}$.
\end{dfn}

\begin{dfn}
\thmtitle{Truncated CI and CC}
Let $\mr{CISDTQPH7}{\cd}m$ denote truncation of the CI Ansatz at $m$-tuples.
Similarly, $\mr{CCS}{\cd}m$ means that we omit cluster operators of excitation level $k>m$.
Note that, unlike $C_k$, the cluster operator $T_k$ in truncated CC describes only \textit{connected $k$-tuples}, which are residual correlations that cannot be decomposed into products of smaller clusters.
As a result, truncated CC actually contains much higher excitations than CI.
\end{dfn}

\begin{ntt}
Let
$\bm{\F}_k$
be a row vector containing all unique $k$-fold substitutions of $\F$,\footnote{That is, $\bm{\F}_k=[\F_{i_1\cd i_k}^{a_1\cd a_k}]$.
Uniqueness can be enforced by requiring $i_1<\cd<i_k$ and $a_1<\cd<a_k$.}
so that $\bm{\F}=\pma{\F\ \bm{\F}_1\,\cd\,\bm{\F}_n}$ spans $\mc{F}_n$.
Using $\bo{c}$ and $\bo{t}$ to denote column vectors of CI coefficients and CC amplitudes leads to the following relationships.\footnote{For the sake of generality we are not assuming intermediate normalization for CI.  The $C_0$ operator scales functions by $c_0$.}
\begin{align}
  \bo{\F}\cdot\bo{c}
=
  (C_0 + C_1+\cd +C_n)\F
&&
  \bo{\F}\cdot\bo{t}
=
  (1 + T_1+\cd +T_n)\F
\end{align}
In Dirac notation the bra $\br{\bo{\F}}$ is transposed, so that
$
  \ip{\bm{\F}|W|\bm{\F}}
=
  [\ip{\F_\si|W|\F_\ta}]
$
is the matrix representation of $W$ in $\mc{F}_n$.
Such matrix representations will be denoted with bolded letters,
$
  \bo{W}
\equiv
  \ip{\bm{\F}|W|\bm{\F}}
$.
\end{ntt}



\begin{rmk}
\label{rmk:ci-perturbative-analysis}
\thmtitle{Perturbative analysis of CI}
Writing the CI eigenvalue equation $\bo{H}_\mr{c}\,\bo{c}=E_\mr{c}\,\bo{c}$ in terms of model-Hamiltonian and fluctuation-potential matrices leads to the following rearranged matrix equation
\begin{align}
\label{eq:ci-matrix-equation}
  (
  -
    \bo{H}_0
  +
    E_\mr{c}
  )\,
  \bo{c}
=
  \bo{V}_\mr{c}\,
  \bo{c}
\end{align}
which provide a convenient starting point for perturbative analysis and for comparison to the coupled-cluster equations.
The matrix elements of the model Hamiltonian are given by
$
  \ip{\F_\si|H_0|\F_\ta}
=
  \mc{E}_\ta
  \d_{\si\ta}
$,
so the matrix on the left is diagonal with eigenvalues
$
-
  \mc{E}_{i_1\cd i_k}^{a_1\cd a_k}
+
  E_\mr{c}
$.
The rows of this equation can be written in terms of CI operators as follows\footnote{See \url{https://en.wikipedia.org/wiki/Floor_and_ceiling_functions} for details on the floor and ceiling functions.}
\begin{align}
\label{eq:ci-reference-equation}
  \underset{(0^+)}{\vphantom{(}
  c_0
  }
  \underset{(2^+)}{\vphantom{(}
    E_\mr{c}
  }
=&\
  \ip{\F|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{((1^+))}{\vphantom{(}
      C_1
    }
    +
    \underset{(1^+)}{\vphantom{(}
      C_2
    }
    )
  |\F}
\\
\label{eq:ci-singles-equation}
  \underset{(1^+)}{\vphantom{(}
  c_a^i
  }
  (\hspace{1pt}
  \underset{(0)}{\vphantom{(}
    \mc{E}_a^i
  }
  +
  \underset{(2^+)}{\vphantom{(}
    E_\mr{c}
  }
  \hspace{-2pt}
  )
=&\
  \ip{\F_i^a|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{((0^+))}{\vphantom{(}
      C_0
    }
    +
    \underset{(1^+)}{\vphantom{(}
      C_1
    }
    +
    \underset{(1^+)}{\vphantom{(}
      C_2
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_3
    }
    )
  |\F}
\\
\label{eq:ci-doubles-equation}
  \underset{(1^+)}{\vphantom{(}
  c_{ab}^{ij}
  }
  (\hspace{1pt}
  \underset{(0)}{\vphantom{(}
    \mc{E}_{ab}^{ij}
  }
  +
  \underset{(2^+)}{\vphantom{(}
    E_\mr{c}
  }
  \hspace{-2pt}
  )
=&\
  \ip{\F_{ij}^{ab}|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(0^+)}{\vphantom{(}
      C_0
    }
    +
    \underset{(1^+)}{\vphantom{(}
      C_1
    }
    +
    \underset{(1^+)}{\vphantom{(}
      C_2
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_3
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_4
    }
    )
  |\F}
\\
  \underset{(2^+)}{\vphantom{(}
  c_{abc}^{ijk}
  }
  (\hspace{1pt}
  \underset{(0)}{\vphantom{(}
    \mc{E}_{abc}^{ijk}
  }
  +
  \underset{(2^+)}{\vphantom{(}
    E_\mr{c}
  }
  \hspace{-2pt}
  )
=&\
  \ip{\F_{ijk}^{abc}|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(1^+)}{\vphantom{(}
      C_1
    }
    +
    \underset{(1^+)}{\vphantom{(}
      C_2
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_3
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_4
    }
    +
    \underset{(3^+)}{\vphantom{(}
      C_5
    }
    )
  |\F}
\\
  \underset{(2^+)}{\vphantom{(}
  c_{abcd}^{ijkl}
  }
  (\hspace{1pt}
  \underset{(0)}{\vphantom{(}
    \mc{E}_{abcd}^{ijkl}
  }
  +
  \underset{(2^+)}{\vphantom{(}
    E_\mr{c}
  }
  \hspace{-2pt}
  )
\underset{\hspace{2pt}\vdots}{\vphantom{(}
=
}&\
  \ip{\F_{ijkl}^{abcd}|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(1^+)}{\vphantom{(}
      C_2
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_3
    }
    +
    \underset{(2^+)}{\vphantom{(}
      C_4
    }
    +
    \underset{(3^+)}{\vphantom{(}
      C_5
    }
    +
    \underset{(3^+)}{\vphantom{(}
      C_6
    }
    )
  |\F}
\\
\label{eq:ci-k-tuples-equation}
  \underset{(\ceil{k/2}^+)}{\vphantom{(}
  c_{a_1\cd a_k}^{i_1\cd i_k}
  }
  (\hspace{1pt}
  \underset{(0)}{\vphantom{(}
    \mc{E}_{a_1\cd a_k}^{i_1\cd i_k}
  }
  +
  \underset{(2^+)}{\vphantom{(}
    E_\mr{c}
  }
  \hspace{-2pt}
  )
=&\
  \ip{\F_{i_1\cd i_k}^{a_1\cd a_k}|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(\ceil{k/2}^+-1)}{\vphantom{(}
      C_{k-2}
    }
    +
    \underset{(\ceil{(k-1)/2}^+)}{\vphantom{(}
      C_{k-1}
    }
    +
    \underset{(\ceil{k/2}^+)}{\vphantom{(}
      C_k
    }
    +
    \underset{(\ceil{(k+1)/2}^+)}{\vphantom{(}
      C_{k+1}
    }
    +
    \underset{(\ceil{k/2}^++\,1)}{\vphantom{(}
      C_{k+2}
    }
    )
  |\F}
\end{align}
where the numbers in parentheses denote orders in perturbation theory and the double parentheses denote terms which vanish under Brillouin's theorem.
The orders of the CI operators follow from the fact that each order in perturbation theory increases the maximum excitation level of the wavefunction by $+2$, starting from $\Y\ord{1}$ which contains up to doubles.
Therefore the leading contributions to $C_k$ have order $\ceil{k/2}$.
If Brillouin's theorem holds, the first-order contribution to $C_1$ vanishes and singles contribute at order $2^+$ in perturbation theory.
\end{rmk}


\begin{ex}
\label{ex:analysis-of-cisd-throuh-q}
The analysis of remark~\ref{rmk:ci-perturbative-analysis} shows that CISD is only correct to first order in the wavefunction, since triples contribute at second order.
However, $C_1$ and $C_2$ are both correct to second order, ensuring that the the CISD correlation energy is correct to third order.
In order to gain an order in perturbation theory we have to increase the truncation level by at least two, since triples and quadruples contribute at the same order.
CISDTQ is correct to second order in the wavefunction and fifth order in the energy.
\end{ex}

\begin{prop}
\label{prop:ci-orders}
\thmstatement{
$\mr{CIS}{\cd}m$
is correct to order
$\floor{m/2}$
in the wavefunction and order
$2\floor{m/2}+1$
in the energy.  
}
\thmproof{
According to \cref{rmk:ci-perturbative-analysis}, the leading term in $C_{m+1}$ has order $\ceil{(m+1)/2}$.
This implies that the wavefunction is correct to
$
  \ceil{(m+1)/2}
-
  1
=
  \floor{m/2}
$
and that
 $C_m$ and $C_{m-1}$ are correct to
$
  \ceil{(m+1)/2}
=
  \floor{m/2}
+
  1
$.
Propagating these truncation errors down to
$C_{m-2h}$
and
$C_{m-1-2h}$
leaves the latter correct to
$
  \floor{m/2}
+
  1
+
  h
$.
One of these operators equals $C_2$ when
$
  h
=
  \floor{m/2}
-
  1
$.
Since $C_2$ limits the error in equation~\ref{eq:ci-reference-equation},\,\footnote{The error propagation ensures that errors decrease monotonically with excitation level.} the energy is correct to
$
  2\floor{m/2}
+
  1
$.
}
\end{prop}

\begin{rmk}
\label{rmk:cc-perturbative-analysis}
\thmtitle{Perturbative analysis of CC}
The CC equations can be written as a non-linear matrix equation.
\begin{align}
\label{eq:cc-matrix-equation}
(
-
  \bo{H}_0
+
  E_\mr{c}\,
  \ip{\bm{\F}|\F}
)
  \bo{t}
=
  \ip{\bm{\F}|
    V_\mr{c}\,
    \mr{exp}(T(\bo{t}))
  |\F}_\mr{C}
\end{align}
To make the comparison with equation~\ref{eq:ci-matrix-equation} more transparent, note that the right-hand side equals
$
  (
    \bo{V}_\mr{c}\hspace{0.8pt}
    \bo{t}
  )_{\mr{C}}
+
  \mc{O}(\bo{t}^2)
$.
Non-vanishing contributions to the rows of this matrix equation can be expressed in terms of cluster operators as follows
\begin{align}
\label{eq:cc-reference-equation}
  \underset{(2^+)}{\vphantom{(}
  E_\mr{c}
  }
=&\
  \ip{\F|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{((1^{+}))}{\vphantom{(}
      T_1
    }
    +
    \underset{(1^{+})}{\vphantom{(}
      T_2
    }
    +
      \tfr{1}{2}
    \underset{(2^{+})}{\vphantom{(}
      T_1^2
    }
    )
  |\F}_\mr{C}
\\[3pt]
  \underset{(1^+)}{\vphantom{(}
  t_a^i
  }
  \underset{(0)}{\vphantom{(}
  \mc{E}_a^i
  }
=&\
  \ip{\F_i^a|
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{((0))}{\vphantom{(}
      1
    }
    +
    \underset{(1^{+})}{\vphantom{(}
      T_1
    }
    +
    \underset{(1^{+})}{\vphantom{(}
      T_2
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_3
    }
    +
      \tfr{1}{2}
    \underset{(2^{+})}{\vphantom{(}
      T_1^2
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_1T_2
    }
    +
      \tfr{1}{3!}
    \underset{(3^{+})}{\vphantom{(}
      T_1^3
    }
    )
  |\F}_\mr{C}
\\[3pt]
\nonumber
  \underset{(1^+)}{\vphantom{(}
  t_{ab}^{ij}
  }
  \underset{(0)}{\vphantom{(}
  \mc{E}_{ab}^{ij}
  }
=&\
  \br{\F_{ij}^{ab}}
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(0)}{\vphantom{(}
      1
    }
    +
    \underset{(1^{+})}{\vphantom{(}
      T_1
    }
    +
    \underset{(1^{+})}{\vphantom{(}
      T_2
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_3
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_4
    }
    +
      \tfr{1}{2}
    \underset{(2^{+})}{\vphantom{(}
      T_1^2
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_1T_2
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_1T_3
    }
\\
\label{eq:cc-doubles-equation}
&
\makebox[0.75\linewidth][r]{\ensuremath{
    +
      \tfr{1}{2}
    \underset{(2^{+})}{\vphantom{(}
      T_2^2
    }
    +
      \tfr{1}{3!}
    \underset{(3^{+})}{\vphantom{(}
      T_1^3
    }
    +
      \tfr{1}{2}
    \underset{(3^{+})}{\vphantom{(}
      T_1^2T_2
    }
    +
      \tfr{1}{4!}
    \underset{(4^{+})}{\vphantom{(}
      T_1^4
    }
    )
  \kt{\F}_\mr{C}
}}
\\[3pt]
\nonumber
  \underset{(2^+)}{\vphantom{(}
  t_{abc}^{ijk}
  }
  \underset{(0)}{\vphantom{(}
  \mc{E}_{abc}^{ijk}
  }
=&\
  \br{\F_{ijk}^{abc}}
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(1^{+})}{\vphantom{(}
      T_2
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_3
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_4
    }
    +
    \underset{(4^{+})}{\vphantom{(}
      T_5
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_1T_2
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_1T_3
    }
    +
      \tfr{1}{2}
    \underset{(2^{+})}{\vphantom{(}
      T_2^2
    }
    +
    \underset{(4^{+})}{\vphantom{(}
      T_1T_4
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_2T_3
    }
\\
\label{eq:cc-triples-equation}
&
\makebox[0.75\linewidth][r]{\ensuremath{
    +
      \tfr{1}{2}
    \underset{(3^{+})}{\vphantom{(}
      T_1^2T_2
    }
    +
      \tfr{1}{2}
    \underset{(4^{+})}{\vphantom{(}
      T_1^2T_3
    }
    +
      \tfr{1}{2}
    \underset{(3^{+})}{\vphantom{(}
      T_1T_2^2
    }
    +
      \tfr{1}{3!}
    \underset{(4^{+})}{\vphantom{(}
      T_1^3T_2
    }
    )
  \kt{\F}_\mr{C}
}}
\\[3pt]
\nonumber
  \underset{(3^+)}{\vphantom{(}
  t_{abcd}^{ijkl}
  }
  \underset{(0)}{\vphantom{(}
  \mc{E}_{abcd}^{ijkl}
  }
=&\
  \br{\F_{ijkl}^{abcd}}
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{(2^{+})}{\vphantom{(}
      T_3
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_4
    }
    +
    \underset{(4^{+})}{\vphantom{(}
      T_5
    }
    +
    \underset{(5^{+})}{\vphantom{(}
      T_6
    }
    +
    \underset{(2^{+})}{\vphantom{(}
      T_1T_3
    }
    +
      \tfr{1}{2}
    \underset{(2^{+})}{\vphantom{(}
      T_2^2
    }
    +
    \underset{(4^{+})}{\vphantom{(}
      T_1T_4
    }
    +
    \underset{(3^{+})}{\vphantom{(}
      T_2T_3
    }
    +
    \underset{(5^{+})}{\vphantom{(}
      T_1T_5
    }
    +
    \underset{(4^{+})}{\vphantom{(}
      T_2T_4
    }
    +
      \tfr{1}{2}
    \underset{(4^{+})}{\vphantom{(}
      T_3^2
    }
\\
\underset{\displaystyle\vdots}{{}}\hspace{2pt}
&
\makebox[0.75\linewidth][r]{\ensuremath{
    +
      \tfr{1}{2}
    \underset{(4^{+})}{\vphantom{(}
      T_1^2T_3
    }
    +
      \tfr{1}{2}
    \underset{(3^{+})}{\vphantom{(}
      T_1T_2^2
    }
    +
      \tfr{1}{2}
    \underset{(5^{+})}{\vphantom{(}
      T_1^2T_4
    }
    +
    \underset{(4^{+})}{\vphantom{(}
      T_1T_2T_3
    }
    +
      \tfr{1}{3!}
    \underset{(3^{+})}{\vphantom{(}
      T_2^3
    }
    +
      \tfr{1}{3!}
    \underset{(5^{+})}{\vphantom{(}
      T_1^3T_3
    }
    +
      \tfr{1}{2!2!}
    \underset{(4^{+})}{\vphantom{(}
      T_1^2T_2^2
    }
    )
  \kt{\F}_\mr{C}
}}
\\[3pt]
  \underset{((k-1)^+)}{\vphantom{(}
  t_{a_1\cd a_k}^{i_1\cd i_k}
  }
  \underset{(0)}{\vphantom{(}
  \mc{E}_{a_1\cd a_k}^{i_1\cd i_k}
  }
=&\
  \br{\F_{i_1\cd i_k}^{a_1\cd a_k}}
  \underset{(1)}{\vphantom{(}
    V_\mr{c}
  }
    (
    \underset{((k-2)^{+})}{\vphantom{(}
      T_{k-1}
    }
    +
    \underset{((k-1)^{+})}{\vphantom{(}
      T_k
    }
    +
    \hspace{2pt}
    \underset{(k^{+})}{\vphantom{(}
      T_{k+1}
    }
    \hspace{1pt}
    +
    \underset{((k+1)^{+})}{\vphantom{(}
      T_{k+2}
    }
    +
      \sum_{p=2}^4
      \fr{1}{p!}
      \sum_{h=p-2}^{2}
      \sum_{\bm{k}}^{\mc{C}_p(k+h)}
    \underset{((k+h-p+\f_{\bm{k}})^+)}{\vphantom{(}
      T_{k_1}
      \cd
      T_{k_p}
    }
    )
  \kt{\F}_\mr{C}
\end{align}
where $\mc{C}_k(m)$ denotes the set of $k$-part integer compositions of $m$
and $\f_{\bm{k}}$ is the number of 1's in
$
  \bm{k}
=
  (k_1,\ld,k_p)
$.
The orders of the cluster operators follow from straightforward induction on the fact that the lowest order contribution to $T_k$ always comes from
$
(
  V_{\mr{c}}
  T_{k-1}
)_\mr{C}
$,
which means that each $T_k$ contributes at one order above $T_{k-1}$, starting from $k=2$.
If Brillouin's theorem holds, $T_1$ has order $2^+$ and the orders of the disconnected products become $(k+h-p+2\,\f_{\bm{k}})^+$.
\end{rmk}

\begin{prop}
\label{prop:cc-orders}
\thmstatement{
$\mr{CCS}{\cd}m$ is correct to order $m-1$ in the wavefunction and order $m+\floor{m/2}$ in the energy.
}
\thmproof{
  According to \cref{rmk:cc-perturbative-analysis}, $T_{m+1}$ contributes at order $m$, implying that the wavefunction is correct to order $m-1$.
  Truncation also leaves $T_m$ and $T_{m-1}$ correct to order $m$, and propagating these truncation errors down to $T_{m-2h}$ and $T_{m-1-2h}$ makes the latter correct to $m+h$.
  One of these operators is $T_2$ when $h=\floor{m/2}-1$.
  Since $T_2$ limits the error in equation \ref{eq:cc-reference-equation}, the energy is correct to order $m+\floor{m/2}$.
}
\end{prop}

\begin{ex}
Props~\ref{prop:ci-orders} and \ref{prop:cc-orders} allow us to compare the accuracies of CI and CC.
At double excitations, CI and CC are both correct to first order in the wavefunction and third order in the energy.
Triples yield no improvement for CI, whereas CC gains an order in both wavefunction and energy.
In general, the CCS${\cd}m$ wavefunction and energy improve upon the wavefunction and energy obtained from
CIS${\cd}m$ by
$
  m
-
  \floor{m/2}
-
  1
=
  \floor{(m-1)/2}
$
orders in perturbation theory.
\end{ex}

\begin{dfn}
\thmtitle{Order $p$ truncation}
If $X$ is a polynomial in $T_1,T_2,\ld,T_n$, we define
its \textit{order $p$ truncation}, denoted $X\bord{p}$,
to include all terms in the polynomial with leading contributions of order $p$ or less.
This makes $X\bord{p}$ correct to order $p$ without isolating specific orders in the cluster operators, which will in general have infinite-order contributions.
\end{dfn}


\begin{samepage}
\begin{ex}
\thmtitle{The $[\mr{T}]$ correction}
Assuming Brillouin's theorem, we can complete the energy to fourth order using
\begin{align}
  t_{ab}^{ij}
\,{=}\,
  \br{\F_{ij}^{ab}}
    R_0
    V_\mr{c}
    (
      1
    \,{+}\,
      T_1
    \,{+}\,
      T_2
    \,{+}\,
      T_3^{[2]}
    \,{+}\,
      \tfr{1}{2}
      T_1^2
    \,{+}\,
      T_1T_2
    \,{+}\,
      \tfr{1}{2}
      T_2^2
    \,{+}\,
      \tfr{1}{3!}
      T_1^3
    \,{+}\,
      \tfr{1}{2}
      T_1^2T_2
    \,{+}\,
      \tfr{1}{4!}
      T_1^4
    )
  \kt{\F}_\mr{C}
&&
  {}\bord{2}
  t_{abc}^{ijk}
\,{=}\,
  \br{\F_{ijk}^{abc}}
    R_0
    V_\mr{c}
    T_2
  \kt{\F}_\mr{C}
\end{align}
where the resulting energy correction is
$
  E_e
-
  E_e^{\mr{CCSD}}
=
  \ip{\F|
    V_\mr{c}
    R_0
    V_\mr{c}
    T_3\bord{2}
  |\F}
$.
We can introduce additional infinite order contributions by noting that
$
  T_2
  \F
=
  R_0
  V_\mr{c}
  \F
+
  \mc{O}(V_\mr{c}^2)
$
and that the additional terms in
$
  \ip{\F|
    T_2\dg
    V_\mr{c}
    T_3\bord{2}
  |\F}
$
are also valid energy contributions in perturbation theory.
There is no risk of double counting since all of these contributions involve connected triples, which are absent in CCSD.
With converged CCD or CCSD $T_2$-amplitudes, this defines the \textit{$[\mr{T}]$ correction}.
\begin{align}
  E_{[\mr{T}]}
\equiv
  \ip{\F|T_2\dg V_\mr{c} T_3\bord{2}|\F}
=
\diagram{
  \interaction{2}{2t}{(0,+0.5)}{ddot}{overhang};
  \interaction{3}{3t}{(0,-0.5)}{ddot}{overhang};
  \node[right=2pt of 3t3 ] {[2]};
  \draw[->-,bend left ] (3t1) to (2t1);
  \draw[-<-,bend right] (3t1) to (2t1);
  \draw[->-,bend left ] (3t2) to (2t2);
  \draw[-<-=0.25,-<-=0.75, bend right]
    (3t2)
    to
      node[ddot,midway] (g1) {}
    (2t2);
  \draw (2,0) node[ddot] (g2) {};
  \draw[sawtooth] (g1) to (g2);
  \draw[->-,bend left=40 ] (3t3) to (g2);
  \draw[-<-,bend right=40] (3t3) to (g2);
}\hspace{-8pt}
+
\diagram{
  \interaction{2}{2t}{(0,+0.5)}{ddot}{overhang};
  \interaction{3}{3t}{(0,-0.5)}{ddot}{overhang};
  \node[right=2pt of 3t3 ] {[2]};
  \draw[->-,bend left ] (3t1) to (2t1);
  \draw[-<-,bend right] (3t1) to (2t1);
  \draw[->-,bend left ] (3t2) to (2t2);
  \draw[-<-=0.25,-<-=0.75, bend right]
    (3t2)
    to
      node[ddot,midway] (g1) {}
    (2t2);
  \draw (2,0) node[ddot] (g2) {};
  \draw[sawtooth] (g1) to (g2);
  \draw[->-,bend left=40 ] (3t3) to (g2);
  \draw[-<-,bend right=40] (3t3) to (g2);
}
&&&&
\diagram{
  \interaction{3}{t}{(0,-0.5)}{ddot}{overhang};
  \draw[->-] (t1) to ++(-0.25,1);
  \draw[-<-] (t1) to ++(+0.25,1);
  \draw[->-] (t2) to ++(-0.25,1);
  \draw[-<-] (t2) to ++(+0.25,1);
  \draw[->-] (t3) to ++(-0.25,1);
  \draw[-<-] (t3) to ++(+0.25,1);
  \node[right=2pt of t3 ] {[2]};
}\hspace{-10pt}
\equiv
\diagram{
  \interaction{2}{t}{(0,-0.5)}{ddot}{overhang};
  \draw[->-] (t1) to ++(-0.25,1);
  \draw[-<-] (t1) to ++(+0.25,1);
  \draw[->-] (t2) to ++(-0.25,1);
  \draw[-<-=0.25,-<-=0.85]
      (t2)
    to
      node[ddot,midway] (g1) {}
    ++(+0.25,1);
  \draw[sawtooth] (g1) to ++(1,0) node[ddot] (g2) {};
  \draw[->-=0.65] (g2) to ++(-0.25,0.5);
  \draw[-<-=0.65] (g2) to ++(+0.25,0.5);
  \draw[thick,flexdotted] (-0.3,0.25) to ++(2.7,0);
}
\,{+}\,
\diagram{
  \interaction{2}{t}{(0,-0.5)}{ddot}{overhang};
  \draw[-<-] (t1) to ++(-0.25,1);
  \draw[->-] (t1) to ++(+0.25,1);
  \draw[-<-] (t2) to ++(-0.25,1);
  \draw[->-=0.25,->-=0.85]
      (t2)
    to
      node[ddot,midway] (g1) {}
    ++(+0.25,1);
  \draw[sawtooth] (g1) to ++(1,0) node[ddot] (g2) {};
  \draw[-<-=0.65] (g2) to ++(-0.25,0.5);
  \draw[->-=0.65] (g2) to ++(+0.25,0.5);
  \draw[thick,flexdotted] (-0.3,0.25) to ++(2.7,0);
}
\end{align}
\end{ex}
\end{samepage}


\begin{rmk}
\thmtitle{CC excited states via equation-of-motion theory}
Similarity transformations preserve operator eigenvalues, so $\ol{H}_e$ has the same spectrum as the original Hamiltonian, $H_e$.
The corresponding eigenvalue equations
\begin{align}
\label{eq:eom-matrix-equations}
  \ol{\bo{H}}_e
  \bo{r}_k
=
  E_k
  \bo{r}_k
&&
  \bo{l}_k\dg
  \ol{\bo{H}}_e
=
  \bo{l}_k\dg
  E_k
&&
  \bo{l}_k^*\cdot
  \bo{r}_l
=
  \d_{kl}
\end{align}
involve both right- and left-eigenvectors since 
$
  \ol{\bo{H}}_e
=
  \ip{\bo{\F}|(H_e\,\mr{exp}(T))_\mr{C}|\bo{\F}}
$
is non-Hermitian.
These can also be written as
\begin{align}
  \ol{H}_e
  \,{}^kR
  \kt{\F}
=
  E_k
  \,{}^kR
  \kt{\F}
&&
  \br{\F}
  \ol{H}_e
  \,{}^kL
=
  \br{\F}
  \,{}^kL
  E_k
&&
  R
=
  R_0
+
  R_1
+
  \cd
+
  R_n
&&
  L
=
  L_0
+
  L_1
+
  \cd
+
  L_n
\end{align}
where $R$ and $L$ are linear excitation and de-excitation operators analogous to $(C_0 + C)$ and $(C_0 + C)\dg$, respectively.
These are the \textit{equation-of-motion coupled-cluster (EOM-CC) equations}.
$E_k$ is the $k\eth$ excited state energy, which matches the corresponding CI eigenvalue unless we truncate the basis.
In general, the expectation value of an observable can be determined as
$
  \ip{\Y_k|W|\Y_k}
=
  \ip{\F|\,{}^kL\ol{W}\,{}^kR|\F}
$
and its transition matrix element is given by
$
  \ip{\Y_k|W|\Y_l}
=
  \ip{\F|\,{}^kL\ol{W}\,{}^lR|\F}
$.\footnote{$\ol{W}\equiv\mr{exp}(-T)W\mr{exp}(T)$}
\end{rmk}

\begin{dfn}
\thmtitle{The CC Lagrangian}
Assuming we have solved equation~\ref{eq:cc-matrix-equation}, the right eigenvector of the ground state is simply a unit vector
$
  \bo{r}_0
=
  \ip{\bo{\F}|\F}
$.
The left ground-state eigenvector is unknown, but the biorthonormality condition in equation~\ref{eq:eom-matrix-equations} tells us that its first entry equals 1.
Therefore, the left and right ground-state wave operators have the form
\begin{align}
\label{eq:cc-ground-state-wave-operators}
  {}^0R
=
  1
&&
  {}^0L
=
  1
+
  \La
&&
  \La
=
  \La_1
+
  \cd
+
  \La_n
\end{align}
where $\La$ is a linear de-excitation operator analogous to $C\dg$.
The ground-state expectation value is therefore
\begin{align}
  E_e
=
  \ip{\Y_e|H_e|\Y_e}
=
  \ip{\F|
    (
      1
    +
      \La
    )
    \ol{H}_e
  |\F}
=
  \mc{L}(\bo{t},\bm{\la})
\end{align}
which is the \textit{coupled-cluster Lagrangian}.
To see why this constitutes a Lagrangian, note that setting its $\bm{\la}$-gradient equal to zero yields the CC amplitude equations: $\ip{\bo{\F}|\ol{H}_e|\F}=0$.
If these are satisfied, then
$
  E_e
=
  \ip{\F|\ol{H}_e|\F}
$
gives the CC energy.
Therefore, we can view the $\bm{\la}$ coefficients as Lagrange multipliers enforcing equation~\ref{eq:cc-matrix-equation} as a constraint.
\end{dfn}


\begin{dfn}
\thmtitle{The CC Lambda equations}
Setting the $\bo{t}$-gradient of the CC Lagrangian equal to zero gives
\begin{align}
  \br{\F}
  (
    1
  +
    \La
  )
  H_\mr{c}\,
  \mr{exp}(T)
  \kt{\F_{i_1\cd i_k}^{a_1\cd a_k}}_\mr{C}
\overset{!}{=}
  0
\end{align}
which are the CC Lambda equations.\footnote{
The subscript $\mr{C}$ here denotes that $H_\mr{c}$ is connected both to the ket and to the $T$ operators.
}
Rearranging this equation gives an alternative, more convenient form
\begin{align}
  \la_{i_1\cd i_k}^{a_1\cd a_k}
  \mc{E}_{a_1\cd a_k}^{i_1\cd i_k}
=
  \br{\F}
  \La
  H_0
  T
  +
  (
    1
  +
    \La
  )
  V_\mr{c}\,
  \mr{exp}(T)
  \kt{\F_{i_1\cd i_k}^{a_1\cd a_k}}_\mr{C}
\end{align}
which sets up the iterative procedure for determining $\la_{i_1\cd i_k}^{a_1\cd a_k}$ from a given set of amplitudes.
\end{dfn}


\begin{ex}
Assuming Brillouin's theorem holds, the CCD lambda equations are as follows.
\begin{align*}
  \la_{ij}^{ab}
  \mc{E}_{ab}^{ij}
=&\
  \ip{\F|
    V_\mr{c}
  +
    \La_2
    V_\mr{c}
  +
    \La_2 V_\mr{c}T_2
  |\F_{ij}^{ab}}_\mr{C}
\\=&\
\diagram{
  \interaction{2}{g}{(0,0.5)}{ddot}{sawtooth};
  \draw[->-] (g1) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-] (g1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-] (g2) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-] (g2) to ++(+0.25,-1) node[smalldot] {};
}
+
\diagram{
  \interaction{2}{t}{(0,0.5)}{ddot}{overhang};
  \draw[->-=0.65] (t1) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-=0.25,-<-=0.75]
      (t1)
    to
      node[ddot,midway] (g1) {}
    ++(+0.25,-1)
      node[smalldot] {};
  \draw[->-=0.65] (t2) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-=0.25,-<-=0.75]
      (t2)
    to
      node[ddot,midway] (g2) {}
    ++(+0.25,-1)
      node[smalldot] {};
   \draw[sawtooth] (g1) to (g2);
}
+
\diagram{
  \interaction{2}{t}{(0,0.5)}{ddot}{overhang};
  \draw[-<-=0.65] (t1) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-=0.25,->-=0.75]
      (t1)
    to
      node[ddot,midway] (g1) {}
    ++(+0.25,-1)
      node[smalldot] {};
  \draw[-<-=0.65] (t2) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-=0.25,->-=0.75]
      (t2)
    to
      node[ddot,midway] (g2) {}
    ++(+0.25,-1)
      node[smalldot] {};
   \draw[sawtooth] (g1) to (g2);
}
+
\diagram{
  \interaction{2}{t}{(0,0.5)}{ddot}{overhang};
  \interaction{2}{g}{(1,0.)}{ddot}{sawtooth};
  \draw[-<-] (t1) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-] (t1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-,bend left=40 ] (g1) to (t2);
  \draw[-<-,bend right=40] (g1) to (t2);
  \draw[-<-] (g2) to ++(-0.25,-0.5) node[smalldot] {};
  \draw[->-] (g2) to ++(+0.25,-0.5) node[smalldot] {};
}
+
\diagram{
  \interaction{2}{l}{(0,0.5)}{ddot}{overhang};
  \interaction{2}{g}{(2,0.5)}{ddot}{sawtooth};
  \draw[overhang] (1.5,0) node[ddot] (t1) {} to ++(1.5,0) node[ddot] (t2) {};
  \draw[-<-=0.65] (l1) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-=0.65] (l1) to ++(+0.25,-1) node[smalldot] {};
  \draw[-<-=0.65] (l2) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-] (t1) to (l2);
  \draw[->-] (t1) to (g1);
  \draw[->-=0.65] (g1) to ++(+0.25,-1) node[smalldot] {};
  \draw[-<-,bend left=40 ] (t2) to (g2);
  \draw[->-,bend right=40] (t2) to (g2);
}
+
\diagram{
  \interaction{2}{l}{(0,0.5)}{ddot}{overhang};
  \interaction{2}{g}{(2,0.5)}{ddot}{sawtooth};
  \draw[overhang] (1.5,0) node[ddot] (t1) {} to ++(1.5,0) node[ddot] (t2) {};
  \draw[->-=0.65] (l1) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-=0.65] (l1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-=0.65] (l2) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-] (t1) to (l2);
  \draw[-<-] (t1) to (g1);
  \draw[-<-=0.65] (g1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-,bend left=40 ] (t2) to (g2);
  \draw[-<-,bend right=40] (t2) to (g2);
}
\\&\
+
\diagram{
  \interaction{2}{l}{(0,0.5)}{ddot}{overhang};
  \interaction{2}{g}{(2.2,0.5)}{ddot}{sawtooth};
  \interaction{2}{t}{(1.1,0.0)}{ddot}{overhang};
  \draw[->-=0.7] (l1) to ++(-0.4,-1) node[smalldot] {};
  \draw[-<-=0.3] (l1) to (t1);
  \draw[->-=0.7] (l2) to ++(-0.4,-1) node[smalldot] {};
  \draw[-<-=0.3] (l2) to (t2);
  \draw[->-=0.3] (g1) to (t1);
  \draw[-<-=0.7] (g1) to ++(+0.4,-1) node[smalldot] {};
  \draw[->-=0.3] (g2) to (t2);
  \draw[-<-=0.7] (g2) to ++(+0.4,-1) node[smalldot] {};
}
+
\diagram{
  \interaction{2}{l}{(0,0.5)}{ddot}{overhang};
  \interaction{2}{g}{(2,0.5)}{ddot}{sawtooth};
  \interaction{2}{t}{(1,0.0)}{ddot}{overhang};
  \draw[-<-=0.65] (l1) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-=0.65] (l1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-,bend left=40 ] (t1) to (l2);
  \draw[-<-,bend right=40] (t1) to (l2);
  \draw[->-,bend left=40 ] (t2) to (g1);
  \draw[-<-,bend right=40] (t2) to (g1);
  \draw[-<-=0.65] (g2) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-=0.65] (g2) to ++(+0.25,-1) node[smalldot] {};
}
+
\diagram{
  \interaction{2}{g}{(0,0.5)}{ddot}{sawtooth};
  \interaction{2}{l}{(2.2,0.5)}{ddot}{overhang};
  \interaction{2}{t}{(1.1,0.0)}{ddot}{overhang};
  \draw[->-=0.7] (g1) to ++(-0.4,-1) node[smalldot] {};
  \draw[-<-=0.3] (g1) to (t1);
  \draw[->-=0.7] (g2) to ++(-0.4,-1) node[smalldot] {};
  \draw[-<-=0.3] (g2) to (t2);
  \draw[->-=0.3] (l1) to (t1);
  \draw[-<-=0.7] (l1) to ++(+0.4,-1) node[smalldot] {};
  \draw[->-=0.3] (l2) to (t2);
  \draw[-<-=0.7] (l2) to ++(+0.4,-1) node[smalldot] {};
}
\\&\
+
\diagram{
  \interaction{2}{g}{(0,0.5)}{ddot}{sawtooth};
  \interaction{2}{l}{(2,0.5)}{ddot}{overhang};
  \draw[overhang] (1.5,0) node[ddot] (t1) {} to ++(1.5,0) node[ddot] (t2) {};
  \draw[-<-=0.65] (g1) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-=0.65] (g1) to ++(+0.25,-1) node[smalldot] {};
  \draw[-<-=0.65] (g2) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-] (t1) to (g2);
  \draw[->-] (t1) to (l1);
  \draw[->-=0.65] (l1) to ++(+0.25,-1) node[smalldot] {};
  \draw[-<-,bend left=40 ] (t2) to (l2);
  \draw[->-,bend right=40] (t2) to (l2);
}
+
\diagram{
  \interaction{2}{g}{(0,0.5)}{ddot}{sawtooth};
  \interaction{2}{l}{(2,0.5)}{ddot}{overhang};
  \draw[overhang] (1.5,0) node[ddot] (t1) {} to ++(1.5,0) node[ddot] (t2) {};
  \draw[->-=0.65] (g1) to ++(-0.25,-1) node[smalldot] {};
  \draw[-<-=0.65] (g1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-=0.65] (g2) to ++(-0.25,-1) node[smalldot] {};
  \draw[->-] (t1) to (g2);
  \draw[-<-] (t1) to (l1);
  \draw[-<-=0.65] (l1) to ++(+0.25,-1) node[smalldot] {};
  \draw[->-,bend left=40 ] (t2) to (l2);
  \draw[-<-,bend right=40] (t2) to (l2);
}
\\=&\
  \ol{g}_{ij}^{ab}
+
  \tfr{1}{2}
  \la_{ij}^{cd}
  \ol{g}_{cd}^{ab}
+
  \tfr{1}{2}
  \la_{kl}^{ab}
  \ol{g}_{ij}^{kl}
+
  P_{(i/j)}^{(a/b)}
  \la_{ik}^{ac}
  \ol{g}_{cj}^{kb}
-
  \tfr{1}{2}
  P_{(i/j)}
  \la_{ik}^{ab}
  t_{cd}^{kl}
  \ol{g}_{jl}^{cd}
-
  \tfr{1}{2}
  P^{(a/b)}
  \la_{ij}^{ac}
  t_{cd}^{kl}
  \ol{g}_{kl}^{bd}
\\&\
+
  \tfr{1}{2^2}
  \la_{ij}^{cd}
  t_{cd}^{kl}
  \ol{g}_{kl}^{ab}
+
  P_{(i/j)}^{(a/b)}
  \la_{ik}^{ac}
  t_{cd}^{kl}
  \ol{g}_{lj}^{db}
+
  \tfr{1}{2^2}
  \ol{g}_{ij}^{cd}
  t_{cd}^{kl}
  \la_{kl}^{ab}
-
  \tfr{1}{2}
  P_{(i/j)}
  \ol{g}_{ik}^{ab}
  t_{cd}^{kl}
  \la_{jl}^{cd}
-
  \tfr{1}{2}
  P^{(a/b)}
  \ol{g}_{ij}^{ac}
  t_{cd}^{kl}
  \la_{kl}^{bd}
\end{align*}
\end{ex}

\begin{samepage}
\begin{rmk}
\thmtitle{The Hellmann-Feynman theorem}
Variational methods satisfy the \textit{Hellmann-Feynman theorem}, which says that the derivative of the energy with respect to a perturbation parameter $\xi$ is independent of the first-order wavefunction response.\footnote{By ``first-order wavefunction response'', we mean $\Y\ord{1}=\left.\fd{\Y(\xi)}{\xi}\right|_0=\left.\pd{\Y}{\bo{c}}\cdot\fd{\bo{c}(\xi)}{\xi}\right|_0$.  Note that this $\Y\ord{1}$ is generally not the first-order correction to the M\o ller-Plesset model Hamiltonian.
Instead, we are usually interested in the energy derivative with respect to a deviation from the full Born-Oppenheimer electronic Hamiltonian, $H(\xi)=H_e+\sum_{m=1}^{\infty} \xi^m H\ord{m}$, controlled by a strength parameter $\xi$.  For example, $\xi$ might be a geometric parameter or a strength parameter for an electromagnetic field strength.}
This follows from the fact that the parameter gradient vanishes by the stationarity condition.
\begin{align}
  \left.
  \fd{E_e(\xi)}{\xi}
  \right|_0
=
  \left.
  \pd{E_e(\xi)}{\xi}
  \right|_0
+
  \left.
  \cancel{
  \pd{E_e}{\bo{c}}
  }
  \cdot
  \fd{\bo{c}(\xi)}{\xi}
  \right|_0
=
  \ip{\Y|
  H\ord{1}
  |\Y}
&&
  H\ord{1}
\equiv
  \left.
  \pd{H(\xi)}{\xi}
  \right|_0
\end{align}
This is not the case for non-variational methods, but the CC Lagrangian satisfies a
\textit{generalized Hellmann-Feynman theorem}
\begin{align}
  \left.
  \fd{\mc{L}(\xi)}{\xi}
  \right|_0
=
  \left.
  \pd{\mc{L}(\xi)}{\xi}
  \right|_0
+
  \left.
  \cancel{
  \pd{\mc{L}}{\bo{t}}
  }
  \cdot
  \fd{\bo{t}(\xi)}{\xi}
  \right|_0
+
  \left.
  \cancel{
  \pd{\mc{L}}{\bm{\la}}
  }
  \cdot
  \fd{\bm{\la}(\xi)}{\xi}
  \right|_0
=
  \ip{\F|
    (
      1
    +
      \La
    )
    H\ord{1}
    \mr{exp}(T)
  |\F}_\mr{C}
\end{align}
which follows from the fact that
$\mc{L}$ is stationary in the amplitudes $\bo{t}$ and their corresponding Lagrange multipliers, $\bm{\la}$.
\end{rmk}
\end{samepage}


\begin{rmk}
\label{rmk:lowdin-partitioning}
\thmtitle{L\"owdin partitioning}
For a given truncation level $m$, let us refer to the span of
$\bm{\F}_\mr{i}=\pma{\F\ \bm{\F}_1\,\cd\,\bm{\F}_m}$
as the
\textit{internal space}
and that of
$\bm{\F}_\mr{e}=\pma{\bm{\F}_{m+1}\,\cd\,\bm{\F}_n}$
as the
\textit{external space}, so that
$
  \kt{\bo{\F}_\mr{i}}
  \br{\bo{\F}_\mr{i}}
+
  \kt{\bo{\F}_\mr{e}}
  \br{\bo{\F}_\mr{e}}
=
  1_n
$.
In the coordinate space over $\bo{\F}$ this reads
$
  \bo{1}_\mr{i}
+
  \bo{1}_\mr{e}
=
  \bo{1}
$,
in terms of the following projection matrices.
\begin{align}
  \bo{1}_\mr{i}
\equiv
  \ip{\bo{\F}|\bo{\F}_\mr{i}}
  \ip{\bo{\F}_\mr{i}|\bo{\F}}
=
\pma[l]{
  \bo{1} & \bo{0} \\
  \bo{0} & \bo{0}
}
&&
  \bo{1}_\mr{e}
\equiv
  \ip{\bo{\F}|\bo{\F}_\mr{e}}
  \ip{\bo{\F}_\mr{e}|\bo{\F}}
=
\pma[l]{
  \bo{0} & \bo{0} \\
  \bo{0} & \bo{1}
}
\end{align}
This allows us to write vector decompositions as
$
  \bo{c}
=
  \bo{c}_\mr{i}
+
  \bo{c}_\mr{e}
$
and matrix decompositions as
$
  \bo{H}
=
  \bo{H}_\mr{ii}
+
  \bo{H}_\mr{ie}
+
  \bo{H}_\mr{ei}
+
  \bo{H}_\mr{ee}
$
in terms of
$
  \bo{c}_\mr{x}
\equiv
  \bo{1}_\mr{x}\,
  \bo{c}
$
and
$
  \bo{H}_\mr{xy}
\equiv
  \bo{1}_\mr{x}\,
  \bo{H}\,
  \bo{1}_\mr{y}
$.\footnote{Note that I am dropping the subscript $e$ on the Hamiltonian and energy here to avoid confusion with $\mr{e}$.}
Finally, note that the \textit{external space resolvent}
$
  \bo{R}_\mr{ee}
\equiv
\left.
  (
    E
  -
    \bo{H}
  )^{-1}
\right|_\mr{e}
$
satisfies
\begin{align}
  \bo{R}_\mr{ee}\,
  (
    E
  -
    \bo{H}
  )
=
-
  \bo{R}_\mr{ee}\,
  \bo{H}_\mr{ei}
+
  \bo{1}_\mr{e}
&&
  (
    E
  -
    \bo{H}
  )\,
  \bo{R}_\mr{ee}
=
-
  \bo{H}_\mr{ie}\,
  \bo{R}_\mr{ee}
+
  \bo{1}_\mr{e}
\end{align}
and operating the left equation on $\bo{c}$ gives zero due to due to the Schr\"odinger equation, implying that
$
  \bo{c}_\mr{e}
=
  \bo{R}_\mr{ee}
  \bo{H}_\mr{ei}
  \bo{c}_\mr{i}
$.
Projecting the Schr\"odinger equation by $\bo{1}_\mr{i}$ and substituting in this expression for $\bo{c}_\mr{e}$ then leads to
\begin{align}
  (
    \bo{H}_\mr{ii}
  +
    \bo{V}_\mr{ii}
  )
  \bo{c}_\mr{i}
=
  E
  \bo{c}_\mr{i}
&&
  \bo{V}_\mr{ii}
\equiv
  \bo{H}_\mr{ie}
  \bo{R}_\mr{ee}
  \bo{H}_\mr{ei}
\end{align}
which reduces the Schr\"odinger equation on $\mc{F}_n$ to an effective Schr\"odinger equation in the internal space.
This gives
\begin{align}
\label{eq:lowdin-functional}
  E
=
  \fr{
    \bo{c}_\mr{i}\dg
    (
      \bo{H}_\mr{ii}
    +
      \bo{V}_\mr{ii}
    )
    \bo{c}_\mr{i}
  }{
    \bo{c}_\mr{i}^*\cdot
    \bo{c}_\mr{i}
  }
\end{align}
which expresses the exact energy in terms of internal-space coefficients.
Let us refer to this energy expression as the \textit{L\"owdin functional}.
The L\"owdin functional is the central equation the \textit{L\"owdin partitioning} method, which can be used to eliminate the leading error incurred by truncating at a given excitation level $m<n$.
\end{rmk}

\begin{rmk}
\thmtitle{L\"owdin partitioning for CC}
The L\"owdin functional generalizes to the CC effective Hamiltonian as
\begin{align}
  E
=
\fr{
  \bo{l}_\mr{i}\dg
  (
    \ol{\bo{H}}_\mr{ii}
  +
    \ol{\bo{V}}_\mr{ii}
  )
  \bo{r}_\mr{i}
}{
  \bo{l}_\mr{i}^*\cdot
  \bo{r}_\mr{i}
}
=
  \ip{\F|
  L
  \ol{H}
  R
  |\F}
+
  \ip{\F|
    L
    \ol{H}
  |\bo{\F}_\mr{e}}
  \ip{\bo{\F}_\mr{e}|
    E
  -
    \ol{H}
  |\bo{\F}_\mr{e}}^{-1}
  \ip{\bo{\F}_\mr{e}|
    \ol{H}
    R
  |\F}
\end{align}
which leads to the following correction to the ground-state correlation energy.
\begin{align}
  E_\mr{c}
-
  E_\mr{c}^{\mr{CCS}{\cd}m}
=
  \ip{\F|
    \La
    \ol{H}_\mr{c}
  |\bo{\F}_\mr{e}}
  \ip{\bo{\F}_\mr{e}|
    E_\mr{c}
  -
    \ol{H}_\mr{c}
  |\bo{\F}_\mr{e}}^{-1}
  \ip{\bo{\F}_\mr{e}|
    \ol{V}_\mr{c}
  |\F}
\end{align}
We can identify the leading term in this correction as follows.
The leftmost factor requires $\ol{H}_\mr{c}$ to have an excitation level of $-1$ or less to fully contract $\La_m$ and $\bo{\F}_{\mr{e}}$, so its leading contribution is
$
  \ol{H}_\mr{c}\ord{1}
=
  V_\mr{c}
$.
The leading contribution to the middle factor enters in zeroth order, yielding
$
-
  \kt{\bo{\F}_\mr{e}}
  \ip{\bo{\F}_\mr{e}|
  \ol{H}_\mr{c}\ord{0}
  |\bo{\F}_\mr{e}}^{-1}
  \br{\bo{\F}_\mr{e}}
=
\left.
  R_0
\right|_{\mr{e}}
$.
The rightmost factor requires $\ol{V}_\mr{c}$ to have an excitation level of $m+1$ in order to fully contract the bra, which first occurs at order
$
  \ol{V}_\mr{c}\bord{m}
=
(
  V_\mr{c}\,
  T_m
)_\mr{C}
$.\,\footnote{Note that we are assuming $m\geq 2$.}
This gives
\begin{align}
\label{eq:parentheses-lambda}
  E_{(m+1)_{\La}}
=
  \br{\F}
    (
      \La_{m-1}
    +
      \La_m
    )
    V_\mr{c}
    T_{m+1}\bord{m}
  \kt{\F}
&&
  \bo{t}_{m+1}\bord{m}
=
  \ip{\bo{\F}_{m+1}|R_0V_\mr{c}T_m|\F}_\mr{C}
\end{align}
where we have made use of the relation
$
  \bo{\F}_k\cdot
  \bo{t}_k
=
  T_k
  \F
$.
This defines the
$
  (m+1)_\La
$
correction to
$
  \mr{CCS}\cd m
$,
generating a hierarchy of perturbatively-corrected CC methods:
CCSD(T)$_\La$,
CCSDT(Q)$_\La$,
CCSDTQ(P)$_\La$,
etc.
\end{rmk}

\begin{ex}
\thmtitle{The $(\mr{T})$ correction}
Since the leading contributions to $\La_1$ and $\La_2$ are given by
\begin{align}
  {}\ord{1}\la_{ij}^{ab}
=
  \br{\F}
  V_\mr{c}
  R_0
  \kt{\F_{ij}^{ab}}
=
  {}\ord{1}t_{ab}^{ij*}
&&
  {}\ord{2}\la_i^a
=
  \br{\F}
  \La_2\ord{1}
  V_\mr{c}
  R_0
  \kt{\F_i^a}
=
  {}\ord{2}t_a^{i*}\,\,,
\end{align}
the approximation $\La_1\approx T_1\dg, \La_2\approx T_2\dg$ will capture the leading terms in the (T)$_\La$ correction plus many higher-order ones.
The resulting \textit{$(\mr{T})$ correction} augments the [T] correction with an order $5^+$ contribution, 
$
  \br{\F}
    T_1\dg
    V_\mr{c}
    T_3\bord{2}
  \kt{\F}
$.
Though less rigorous than the (T)$_\La$ correction, (T) is computationally advantageous in that it avoids solution of the $\La$ equations. 
\begin{align}
  E_{(\mr{T})}
=
  E_{[\mr{T}]}
+
  \br{\F}
    T_1\dg
    V_\mr{c}
    T_3\bord{2}
  \kt{\F}
=
\diagram{
  \interaction{2}{2t}{(0,+0.5)}{ddot}{overhang};
  \interaction{3}{3t}{(0,-0.5)}{ddot}{overhang};
  \node[right=2pt of 3t3 ] {[2]};
  \draw[->-,bend left ] (3t1) to (2t1);
  \draw[-<-,bend right] (3t1) to (2t1);
  \draw[->-,bend left ] (3t2) to (2t2);
  \draw[-<-=0.25,-<-=0.75, bend right]
    (3t2)
    to
      node[ddot,midway] (g1) {}
    (2t2);
  \draw (2,0) node[ddot] (g2) {};
  \draw[sawtooth] (g1) to (g2);
  \draw[->-,bend left=40 ] (3t3) to (g2);
  \draw[-<-,bend right=40] (3t3) to (g2);
}\hspace{-8pt}
+
\diagram{
  \interaction{2}{2t}{(0,+0.5)}{ddot}{overhang};
  \interaction{3}{3t}{(0,-0.5)}{ddot}{overhang};
  \node[right=2pt of 3t3 ] {[2]};
  \draw[->-,bend left ] (3t1) to (2t1);
  \draw[-<-,bend right] (3t1) to (2t1);
  \draw[->-,bend left ] (3t2) to (2t2);
  \draw[-<-=0.25,-<-=0.75, bend right]
    (3t2)
    to
      node[ddot,midway] (g1) {}
    (2t2);
  \draw (2,0) node[ddot] (g2) {};
  \draw[sawtooth] (g1) to (g2);
  \draw[->-,bend left=40 ] (3t3) to (g2);
  \draw[-<-,bend right=40] (3t3) to (g2);
}\hspace{-8pt}
+
\diagram{
  \interaction{1}{1t}{(0,+0.5)}{ddot}{overhang};
  \interaction{2}{g}{(1,+0.5)}{ddot}{sawtooth};
  \interaction{3}{3t}{(0,-0.5)}{ddot}{overhang};
  \node[right=2pt of 3t3 ] {[2]};
  \draw[->-,bend left ] (3t1) to (1t1);
  \draw[-<-,bend right] (3t1) to (1t1);
  \draw[->-,bend left ] (3t2) to (g1);
  \draw[-<-,bend right] (3t2) to (g1);
  \draw[->-,bend left ] (3t3) to (g2);
  \draw[-<-,bend right] (3t3) to (g2);
}
\end{align}
The CCSD(T) method was originally justified on different grounds, but its truly remarkable performance is difficult to understand using ordinary perturbation theory.
Several other fifth-order terms could just as easily be included, and there is no strong \emph{a priori} reason to expect this one to be as magical as it is.
L\"owdin partitioning suggests that $E_{(\mr{T})}$ is the leading correction to the error incurred by truncating the configuration space at doubles.
\end{ex}



\end{document}