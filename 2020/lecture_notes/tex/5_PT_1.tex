\documentclass{article}
\usepackage{amsmath,mathtools,amssymb}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{blkarray}
\usepackage{gensymb}
\usepackage{verbatim}
\usepackage{mathrsfs}
\usepackage{bbm}
\usepackage{braket}
\usepackage{hyperref}
\usepackage{verbatim}
\usepackage{cancel}
\usepackage[margin=1.0in]{geometry}
\newcommand{\ol}{\overline}
\newcommand{\lp}{\left(}
\newcommand{\rp}{\right)}
\newcommand{\eps}{\varepsilon}
\newcommand{\lam}{\lambda}
\newcommand{\h}{\circ}
\newcommand{\p}{\bullet}

\newcommand{\Ezero}{E^{(0)}}
\newcommand{\Phizero}{\Phi^{(0)}}
\newcommand{\Eone}{E^{(1)}}
\newcommand{\Phione}{\Phi^{(1)}}

\newcommand{\Ecorr}{E_{\mathrm{corr}}}
\newcommand{\Hc}{H_{\mathrm{c}}}
\newcommand{\dg}{\ensuremath{^\dagger} }
\def\*#1{\mathbf{#1}}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\title{Lecture 5: Perturbation Theory}
\date{April 1, 2020}
\begin{document}
\maketitle
\noindent
To remind you of the current task at hand, we are trying to find good quality approximations 
    to electronic wavefunctions in order to obtain the electronic energy of a molecular system. 
That is, we seek to solve the Schr{\"o}dinger equation in the best way possible.
\[H \ket{\Psi} = E \ket{\Psi} \]
We already learned that HF theory is a decent and cheap approximation, and full-CI is exact but very expensive. 
Perturbation theory is one of many approaches to finding wavefunctions and energies which are of 
    reasonable cost and reasonable accuracy.
Recall, however, that the HF wavefunction $\Phi$ gives us a very good starting point, so we are really just interested in solving for the correlation energy,
which is obtained by shifting our Hamiltonian by the HF energy.
\[\Hc \ket{\Psi} = \Ecorr \ket{\Psi} \]
where 
\[\Hc = H - \braket{\Phi| H | \Phi} \]
\[\Ecorr = E_{\mathrm{exact}} - E_{\mathrm{HF}}\]

We will start by discussing Rayleigh-Schr{\"o}dinger perturbation theory (RSPT), which applies the ideas of PT to the time-independent 
    Schr{\"o}dinger equation.
Next, we will apply the results of RSPT to derive M{\o}ller-Plesset methods (MP$n$) for approximating the electronic correlation energy of molecular systems. 

\section{Rayleigh-Schr{\"o}dinger Perturbation Theory}
Perturbation theory (PT), in the most general sense, is applicable in nearly every domain of physics. 
If a problem can be separated into some easily solvable piece A and not-so-easily solvable piece B 
    (``the perturbation''), one can approach the exact solution of the problem in terms of the solution to A 
    plus a series of corrections to account for the influence of perturbation.
Rayleigh-Schr{\"o}dinger Perturbation Theory (RSPT) applies the ideas of PT to the time-independent 
    Schr{\"o}dinger equation.
The Hamiltonian is decomposed into a sum of a simple (easy to solve) problem $H_0$ and a perturbation $V$:
\[H = H_0 + V \]
If the perturbation is ``small'' (i.e., does not wildly shift the solutions of the problem) the 
    energy levels/eigenstates associated with the \textit{perturbed system} described by $H$ can be expressed 
    as sum of the energy levels/eigenstates of  the \textit{simple system} (described by $H_0$) and a series 
    of corrections obtained by considering the influence of the perturbation $V$ on the 
    energy levels/eigenstates of the simple system.
Each of these corrections contain eigenvalues of $H_0$ and matrix elements of the perturbation 
    between the eigenfunctions of $H_0$, as we will see.
In summary, RSPT is applying age-old ideas of general perturbation theory to the
    time independent Schr{\"o}dinger equation.

The eigenvalue problem we wish to solve is the following:
\[H \ket{\Psi_i} = (H_0 + V) \ket{\Psi_i} = E_i \ket{\Psi_i}\]
We are assuming $H_0$ is a simple, easy-to-solve system, for which we have access to all the eigenstates 
    and eigenvalues.
\[H_0 \ket{\Phi_i^{(0)}} = E_i^{(0)} \ket{\Phi_i^{(0)}} \]
These eigenstates $\ket{\Phi_i^{(0)}}$ and eigenvalues $E_i$ for the simple system are hopefully very close
    to the exact results  $\ket{\Psi_i}$ and  $E_i$, that is, the perturbation $V$ is small.
Now, we do something a bit weird.
We introduce a parameter $\lam$ in front of $V$, which allows us to toggle the influence of the
    perturbation on the energy levels and eigenstates. 
Before saying much else about $\lam$, let's write it down and see what it allows us to do.
\[(H_0 +  \lam V) \ket{\Psi_i} = E_i \ket{\Psi_i}\]
When $\lam = 0$, our Hamiltonian is just $H_0$, and our eigenstates and energy levels become that 
    of the simple system $\ket{\Phi_i^{(0)}}$ and $ E_i^{(0)}$.
When $\lam = 1$, our Hamiltonian is the full Hamiltonian $H$, and our eigenstates and energy levels 
    are the perturbed system $\ket{\Psi_i^{(0)}}$ and $E_i$.
By doing this, \textit{the energy levels and eigenstates of the perturbed system are a function
    of }$\lam$.
To put it another way, our energy levels and eigenstates depend on lambda; 
    we might express this mathematically as  $E_i(\lam)$ and $\Psi_i(\lam)$.
Since these quantities are \textit{functions of} $\lam$, we can write down a Taylor series
expansion of the energy levels and eigenstates of $H$ in terms of $\lam$:
\[E_i =  E_i^{(0)} +  \lam E_i^{(1)} + \lam^2 E_i^{(2)}  + \cdots \]
\[\ket{\Psi_i} =  \Phi_i^{(0)} +  \lam \Phi_i^{(1)} + \lam^2 \Phi_i^{(2)} + \cdots \]
where each term is,  
\[ E_i^{(k)} = \left. \frac{1}{k!} \frac{d^k E_i}{d \lam^k} \right\rvert_{\lam = 0} \]
\[ \Psi_i^{(k)} = \left. \frac{1}{k!} \frac{d^k \ket{\Psi_i}}{d \lam^k} \right\rvert_{\lam = 0} \]

We call $E_i^{(0)}$ the 0$^{th}$ order energy, which is the energy of the simple system. 
Every additional term in the energy expansion is the $n^{th}$ order energy correction, 
    and these are what we must solve for.
Likewise terminology is used for the eigenstates $\ket{\Psi_i^{(k)}}$


Many textbooks and other resources simply say $\lam$ is a 
    ``fictitious dummy parameter'' or ``book-keeping device'' that is 
    used to keep track of the  ``orders'' of the terms when working with the perturbation expansion.
This is a bit of an oversimplification. The parameter $\lam$ has the utility of turning
the perturbation on/off, and motivates the use of a Taylor expansion in the first place.
Without $\lam$, you have no Taylor expansion, and no perturbation theory. 
While it does serve as a useful label for the orders of each term, it's not just a ``dummy'' parameter. 
It's the key to all of perturbation theory.


We have a form for the wavefunction and the energy. Plugging these 
into the time-independent Schr{\"o}dinger equation, we get 
\[
(H_0 + \lam V) (\Phi_i^{(0)} +  \lam \Phi_i^{(1)} + \lam^2 \Phi_i^{(2)} + \cdots)
=  (E_i^{(0)} +  \lam E_i^{(1)} + \lam^2 E_i^{(2)}  + \cdots ) (\Phi_i^{(0)} +  \lam \Phi_i^{(1)} + \lam^2 \Phi_i^{(2)} + \cdots)
 \]

Subtracting from each side so that the left is 0 and grouping like powers of $\lam$ gives
\begin{align*}
&  \left(H_0 \ket{\Phi_i^{(0)}} - E_i^{(0)} \ket{\Phi_i^{(0)}}   \right) \\
&+ \lam \left( H_0\ket{\Phi_i^{(1)}} + V\ket{\Phi_i^{(0)}} - E_i^{(0)}\ket{\Phi_i^{(1)}} - E_i^{(1)}\ket{\Phi_i^{(0)}} \right)  \\
&+ \lam^2 \left( H_0 \ket{\Phi_i^{(2)}} + V \ket{\Phi_i^{(1)}} - E_i^{(0)} \ket{\Phi_i^{(2)}} - E_i^{(1)} \ket{\Phi_i^{(1)}} - E_i^{(2)} \ket{\Phi_i^{(0)}}  \right)  \\
&+ \cdots \\ 
&= 0
\end{align*}

The only way the above equation can be satisfied for any arbitrary value of $\lam$ is 
    if the coefficient in parentheses for each power of $\lam$ is equal to 0.
Therefore, since each term for each power of $\lam$ is equal to 0,
    this equation is fully separable into an infinite series of simultaneous equations
\begin{align*}
&  H_0 \ket{\Phi_i^{(0)}} = E_i^{(0)} \ket{\Phi_i^{(0)}}   \\
&  H_0\ket{\Phi_i^{(1)}} + V\ket{\Phi_i^{(0)}} = E_i^{(0)}\ket{\Phi_i^{(1)}} + E_i^{(1)}\ket{\Phi_i^{(0)}}  \\
&  H_0 \ket{\Phi_i^{(2)}} + V \ket{\Phi_i^{(1)}} = E_i^{(0)} \ket{\Phi_i^{(2)}} + E_i^{(1)} \ket{\Phi_i^{(1)}} + E_i^{(2)} \ket{\Phi_i^{(0)}}  \\
& \cdots \\ 
\end{align*}
Notice we have now dropped the $\lam$'s since each of the above equations hold whether or not $\lam^n$ is applied to each term.
You could also interpret this as us setting $\lam=1$, and fully ``turning on'' the perturbation.

We will assume henceforth that our reference state is normalized  $\braket{\Phizero_i | \Phizero_i} = 1$
and our exact wavefunction is intermediately normalized $\braket{\Phizero_i | \Psi_i} = 1$.
This yields,
\[\braket{\Phizero_i | \Psi_i} = 1 = \braket{\Phizero_i | \Phizero_i} + \lam \braket{\Phizero_i \ \Phione_i} + \lam^2 \braket{\Phizero_i|\Phi_i^{(2)}} + \cdots \]
In order for the above expression to be true for arbitrary $\lam$,
it must be the case that $\braket{\Phizero_i | \Phi_i^{(k)} = 0 \mathrm{for k} = 1,2,3,...}$

We can now project each equation in our system of equations on the left by $\bra{\Phi_i^{(0)}}$.
We can simplify quite a bit by noting $\braket{\Phizero_i | \Phi_i^{(k)} = 0 \mathrm{for k} = 1,2,3,...}$ 
and that since $H_0$ is Hermitian, we can act it act on the left to give 
$ \braket{\Phizero_i | H_0 | \Phi_n^{(k)}   } = \Ezero_i \braket{\Phizero_i | \Phi_i^{(k)}}  $.

The final result is:
\begin{align*}
E_i^{(0)} = \braket{\Phi_i^{(0)} | H_0 | \Phi_i^{(0)}} \\
E_i^{(1)} = \braket{\Phi_i^{(0)} | V | \Phi_i^{(0)}} \\
E_i^{(2)} = \braket{\Phi_i^{(0)} | V | \Phi_i^{(1)}} \\
\end{align*}

Notice that $E_i^{(1)}$ depends on $\Phi_i^{(0)}$, and $E_i^{(2)}$ depends on $\Phi_i^{(1)}$.
This trend continues on for higher order energy corrections: 
    the $n^{th}$ order correction to the wavefunction is required for finding the $(n+1)^{th}$ order energy correction.

% Note, algebra in Szabo/Ostlund was archaic, instead used this https://www.lct.jussieu.fr/pagesperso/toulouse/enseignement/introduction_pt_cc.pdf
% combined with some other sources
\subsection{The first-order wavefunction and second-order energy corrections}
The third equation above, the second-order energy ($E_i^{(2)}$) correction, requires you to know the 1st order correction to the wavefunction $\Phione_i$.
To obtain it, we take the equation containing our 1st-order terms and rearrange:

\[ H_0\ket{\Phione_i} + V \ket{\Phizero_i} = \Ezero_i \ket{\Phione_i} + \Eone_i \ket{\Phizero_i} \]
Projecting by $\bra{\Phizero_n}$ for some $n \neq i$ gives 

\[ \braket{\Phizero_n | H_0 | \Phione_i} + \braket{ \Phizero_n | V | \Phizero_i} = \Ezero_i \braket{\Phizero_n|\Phione_i} + \Eone_i \braket{\Phizero_n | \Phizero_i} \]

To simplify, note that $\bra{\Phizero_n} H_0 = \Ezero_n \bra{\Phizero_n}$, so the first term on the left becomes $\Ezero_n \braket{\Phizero_n | \Phione_i} $
The second term on the right goes to 0 since $\braket{\Phizero_n|\Phizero_i} = 0 $ when $n \neq i$. 
The reason is these are both eigenfunctions of $H_0$, which are orthonormal.
We are left with
\[ \Ezero_n \braket{ \Phizero_n | \Phione_i} + \braket{ \Phizero_n | V | \Phizero_i} = \Ezero_i \braket{ \Phizero_n | \Phione_i }    \]
Rearranging we get
\[ \braket{\Phizero_n | \Phione_i } = -\frac{ \braket{ \Phizero_n | V | \Phizero_i} }{ \Ezero_n - \Ezero_i} \]

We want to get $\ket{\Phione_i}$ by itself on the left side.
The left side above is the expansion coefficients of $ \Phione_i$ in the basis of $\Phizero_n$.
To see this, project each side by $ \ket{\Phizero_n} $ and sum over all $n \neq i$
\[ \sum_{n \neq i} \ket{ \Phizero_n} \braket{\Phizero_n | \Phione_i } = \sum_{n \neq i} -\frac{ \braket{ \Phizero_n | V | \Phizero_i} }{ \Ezero_n - \Ezero_i} \ket{\Phizero_n} \]

The left side above would be equal to $\ket{\Phione_i}$ if the sum was over all $n$ (resolution of the identity), 
    but if we sum over all $n$, the energy denominator on the right will be 0 for $n = i$. 
Fortunately, the expansion coefficient $\braket{\Phizero_n | \Phione_i } $ for $n = i$ is necessarily 0.
Why? Because of intermediate normalization.
\[\braket{\Phizero_i | \Psi_i} = 1 = \braket{\Phizero_i | \Phizero_i} + \lam \braket{\Phizero_i | \Phione_i} + \lam^2 \braket{\Phizero_i|\Phi_i^{(2)}} + \cdots \]

Since our reference wavefunction is normalized $\braket{\Phizero_i | \Phizero_i} = 1$, in order for this expression to be true for arbitrary $\lam$,
it must be the case that $\braket{\Phizero_i | \Phi_i^{(k)} = 0 \mathrm{for k} = 1,2,3,...}   $
This implies that when $n = i$, the expansion coefficient is 0.
Therefore, we can sum over all $n$ (rather than $n \neq i$) on the left side of our expression for $\ket{\Phione_i}$ without penalty; it is the same as adding zero to both sides:
\[ \sum_{n} \ket{ \Phizero_n} \braket{\Phizero_n | \Phione_i } = \sum_{n \neq i} -\frac{ \braket{ \Phizero_n | V | \Phizero_i} }{ \Ezero_n - \Ezero_i} \ket{\Phizero_n} \]
Noting the left side contains the resolution of the identity, we can just remove it:
\[ \ket{\Phione_i} = \sum_{n \neq i} -\frac{ \braket{ \Phizero_n | V | \Phizero_i} }{ \Ezero_n - \Ezero_i} \ket{\Phizero_n} \]

This now enables us to derive an evaluable expression for the second-order energy 
\[ E_i^{(2)} = \braket{\Phi_i^{(0)} | V | \Phi_i^{(1)}} \]
Plugging in the definition for $\Phi_i^{(1)}$ above we obtain
\[ E_i^{(2)} = \sum_{n \neq i} -\frac{ \braket{ \Phizero_n | V | \Phizero_i} \braket{ \Phizero_i | V | \Phizero_n} }{ \Ezero_n - \Ezero_i} \ket{\Phizero_n} \]
\[ E_i^{(2)} = \sum_{n \neq i} \frac{ |\braket{ \Phizero_i | V | \Phizero_n} |^2  }{ \Ezero_i - \Ezero_n} \]

One could keep working through the tedious algebra and derive the expressions for the second order wavefunction, third order wavefunction, etc, and
in turn obtain energy corrections $E_i^{(3)}$, $E_i^{(4)}$, etc, but we will stop here.
The above results are sufficient for deriving second-order M{\o}ller--Plesset perturbation theory.

There does exist a more advanced scheme which generalizes the results of all orders of perturbation theory using a mysterious new thing called ``resolvents''.
We will touch on this at the end of these notes and continue down that path after learning diagrams. 

RSPT, as described above, is a completely general scheme, applicable to any application of the time-independent Schrodinger equation.
We will use these ideas to come up with a way to obtain electronic energies with RSPT. 

\section{M{\o}ller--Plesset Perturbation Theory}
M{\o}ller--Plesset Perturbation Theory (MP$n$) is the direct application of time-independent RSPT to the problem of finding electronic wavefunctions and energies.
In this section, we will derive MP2 by applying the RSPT equations derived above for a specific partition of our electronic Hamiltonian into $H_0$ and $V$.
The MP2 energy which is correct up to second-order.

We first must divide our Hamiltonian into two parts, one which has a simple solution $H_0$ and the perturbation $V$.
\[H = H_0 + V \]
In MP$n$ methods, the $H_0$ part of the Hamiltonian is taken to be the Hartree-Fock Hamiltonian,
\[H_0 = F = (h_p^q + \bar{g}_{pi}^{qi}) a_q^p = f_p^q a_q^p  \]
Note here we are \textbf{not} using the $\Phi$-normal ordered Fock operator $f_p^q \tilde{a}_q^p$.
The perturbation $V$ will just be everything not included in $H_0$. 
\[V = H - F \]
\[V =  \frac{1}{4} \bar{g}_{pq}^{rs} a_{rs}^{pq} - \bar{g}_{pi}^{qi} a_{q}^{p}  \]
One could interpret $V$, the perturbation, as being all of the two-electron interactions, except for the mean-field picture already given by the HF Hamiltonian.

Suppose we seek the energy of the ground state of a system (which we will denote by a subscript 0).
The ground state 0th order wavefunction $\Phi_0^{(0)}$ is the Hartree-Fock Slater determinant wavefunction. 
The ground state 0th order energy is given by $E_0^{(0)} = \braket{\Phi_0^{(0)} | H_0 | \Phi_0^{(0)}}$
\begin{align*}
E_0^{(0)} &= \braket{\Phi_0^{(0)} | H_0 | \Phi_0^{(0)}} \\
          &= \sum_i h_{ii} + \sum_{ij} \braket{ij||ij}  
\end{align*}
We note the above expression, from Hartree-Fock theory, is equal to the sum of the occupied orbital energies $\sum_i \eps_i$
\[E_0^{(0)} = \sum_i h_{ii} + \sum_{ij} \braket{ij||ij} = \sum_i \eps_i  \]

The 1st order energy correction is given by $E_0^{(1)} = \braket{\Phi_0^{(0)} | V | \Phi_0^{(0)}}$
\begin{align*}
E_0^{(1)} &= \braket{\Phi_0^{(0)} | V | \Phi_0^{(0)}} \\
          &= -\frac{1}{2} \sum_{ij} \braket{ij||ij} 
\end{align*}

We notice immediately that the sum of the 0th and 1st order energies is the Hartree-Fock energy.
\[ E_0^{(0)} + E_0^{(1)} = \sum_i h_{ii} + \frac{1}{2}\sum_{ij} \braket{ij||ij}   \] 

Thus, the first two terms of our energy perturbation expansion is the HF energy.
\[E_0 =  E_0^{(0)} +  E_0^{(1)} + E_0^{(2)} + \cdots \]
\[E_0 =  E_{\mathrm{HF}} + E_0^{(2)} + \cdots \]
It must be that all higher-order terms constitute \textit{correlation energies}, since in principle the expansion should approach the exact 
    energy so long as the perturbation is small.

The second-order energy correction to the ground state energy is given by 
\[ E_0^{(2)} = \sum_{n \neq 0} \frac{ |\braket{ \Phizero_0 | V | \Phizero_n} |^2  }{ \Ezero_0 - \Ezero_n}  \]
What sort of states are $\Phizero_n$? They can be any excitation from our ground state reference HF determinant $\Phi_0$ (any determinant in our CI expansion).
However, we find that single excitations do not survive:
\[ \braket{\Phi_0 | V | \Phi_i^a } =  \braket{\Phi_0 | H - H_0 | \Phi_i^a } = \braket{\Phi_0 | H | \Phi_i^a } - \braket{\Phi_0 | H_0 | \Phi_i^a }  = 0 \]
Triple and higher excitations do not survive because you cannot form complete contractions, so $\Phizero_n$ can only be the set of unique doubly excited determinants. 
What about the $\Ezero_0$ and $\Ezero_n $?
Recall $\Ezero_0$ is the eigenvalue of $H_0$ acting on our Hartree-Fock determinant,
\[H_0 \ket{\Phi_0^{(0)}} = E_0^{(0)} \ket{\Phi_0^{(0)}} \]
 which is just the sum of the occupied orbital energies $E_0^{(0)} = \sum_k \eps_k$,.
The same is true for $\Ezero_n$, but it has a sum over occupied orbital energies which differs by two spin orbital occupations. Thus,
\[\Ezero_0 - \Ezero_n =  \sum_k \eps_k - ( \sum_k \eps_k - (\eps_i + \eps_j - \eps_a - \eps_b)) \]
\[\Ezero_0 - \Ezero_n =  \eps_i + \eps_j - \eps_a - \eps_b \]

So we finally obtain for the second order energy expression,
\[ E_0^{(2)} = \sum_{n \neq 0} \frac{ |\braket{ \Phizero_0 | V | \Phizero_n} |^2  }{ \Ezero_0 - \Ezero_n}  \]
\[ E_0^{(2)} = \sum_{\substack{i < j \\ a < b}} \frac{ |\braket{ \Phi_0 | V | \Phi_{ij}^{ab}} |^2}{ \eps_i + \eps_j - \eps_a - \eps_b  }  \]
Noting that only the first term of $V$ yields a nonzero result,
\[ E_0^{(2)} = \sum_{\substack{i < j \\ a < b}} \frac{ |\braket{ \Phi_0 | \frac{1}{4} \bar{g}_{pq}^{rs} a_{rs}^{pq} | \Phi_{ij}^{ab}} |^2}{ \eps_i + \eps_j - \eps_a - \eps_b  }  \]
\[ E_0^{(2)} = \frac{1}{16} \sum_{\substack{i < j \\ a < b}}  \frac{ |\braket{ ij || ab}|^2}{ \eps_i + \eps_j - \eps_a - \eps_b}\]
\[ E_0^{(2)} = \frac{1}{4} \sum_{ijab} \frac{ |\braket{ ij || ab}|^2}{ \eps_i + \eps_j - \eps_a - \eps_b}\]


% Give expression for MP3, say how complicated things get, motivate Piecuch style

\section{L{\"o}wdin and his Resolvents}
 


\end{document}
