\documentclass{article}
\usepackage{simplewick}
\usepackage{amsmath,mathtools,amssymb}
\usepackage{graphicx}
\usepackage{gensymb}
\usepackage{verbatim}
\usepackage{cancel}
\usepackage{mathrsfs}
\usepackage{bbm}
\usepackage{braket}
\usepackage{xcolor}
\definecolor{orange}{RGB}{255,127,0}
\definecolor{green}{RGB}{34,139,34}
\definecolor{purple}{RGB}{153,50,204}
\definecolor{blue}{RGB}{70,130,180}
\usepackage{verbatim}
\usepackage[margin=1.0in]{geometry}
\newcommand{\ol}{\overline}
\newcommand{\ctr}{\bcontraction}
\newcommand{\tl}{\tilde}
\newcommand{\h}{\circ}
\newcommand{\p}{\bullet}
\newcommand{\fctr}{\contraction}
\newcommand{\ve}{\varepsilon}
\newcommand{\kphi}{\ensuremath{\ket{\Phi}} }
\newcommand{\ap}{\ensuremath{a_p} }
\newcommand{\dg}{\ensuremath{^\dagger} }
\newcommand{\cd}{\ensuremath{\cdots} }
\newcommand{\apd}{\ensuremath{a_p^\dagger} }
\def\*#1{\mathbf{#1}}
\def\cb#1{{\color{blue}#1}}
\def\co#1{{\color{orange}#1}}
\def\cre#1{{\color{red}#1}}
\def\cg#1{{\color{green}#1}}
\def\cp#1{{\color{purple}#1}}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\title{Lecture 3.7:  Kutznelnigg--Mukherjee Notation}
\date{March 4$^{\text{th}}$, 2020}
\begin{document}
\maketitle
\section{Our current notation falls short}
Under our current notation, we would write a Wick expansion of the two-electron operator as: 
\begin{align*}
a_p\dg a_q\dg a_s a_r  &= N[a_p\dg a_q\dg a_s a_r  ] \\ 
&+ N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg a_q\dg a_s a_r  ] + N[ \fctr{}{x}{{}_1a_q\dg  a_s }{x} a_p\dg a_q\dg a_s a_r  ] 
+ N[ \fctr{a_p\dg }{x}{{}_2}{x} a_p\dg a_q\dg a_s a_r  ] +  N[ \fctr{a_p\dg }{x}{{}_2 a_s }{x} a_p\dg a_q\dg a_s a_r  ] \\
&+ N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x}      a_p\dg a_q\dg a_s a_r  ] 
+ N[ \fctr{}{x}{{}_1a_q\dg }{x}  \fctr[2ex]{a_p\dg }{x}{{}_2 a_s }{x} a_p\dg a_q\dg a_s a_r  ] 
\end{align*}
If we were to evaluate the matrix element: 
\[\braket{\Phi | a_p\dg a_q\dg a_s a_r  | \Phi} \]
we would only have to consider the last two fully contracted terms in the Wick expansion. 
This is tedious, but doable.
However, there are some matrix elements that would take literally hours or days to solve with the current notation.
\\ \\
For example,
\[\braket{\Phi | N[a_k\dg a_l\dg a_d a_c] N[a_p\dg a_q\dg a_s a_r] N[a_a\dg a_b\dg a_j a_i] | \Phi} \]
has 80 fully contracted terms we would have to evaluate! 
This is far from ideal. 
\\ \\
We will now learn two methods that will simplify the way we write these terms and make their evaluation doable.
\section{Reduced index antisymmetrizers}
First, we will address how we can group certain contractions together and express them generally. 
In the Wick expansion of $a_p\dg a_q\dg a_s a_r $ above, we thought about the possible contractions by keeping the order of terms fixed and moving the contraction lines.
The overall sign came from the number of permutations it took to form a neighboring contraction and move the contraction out of the $\Phi$-Normal product.  \\ \\
For example, the terms with single contractions can be evaluated in the following manner: 
\begin{align*}
&N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg a_q\dg a_s a_r  ] + N[ \fctr{}{x}{{}_1a_q\dg  a_s }{x} a_p\dg a_q\dg a_s a_r  ] 
+ N[ \fctr{a_p\dg }{x}{{}_2}{x} a_p\dg a_q\dg a_s a_r  ] +  N[ \fctr{a_p\dg }{x}{{}_2 a_s }{x} a_p\dg a_q\dg a_s a_r  ] \\ 
= - & N[ \fctr{}{x}{{}_1 }{x} a_p\dg  a_s a_q\dg a_r  ] + N[ \fctr{}{x}{{}_1 }{x} a_p\dg a_r a_q\dg a_s   ] 
+ N[ \fctr{a_p\dg }{x}{{}_2}{x} a_p\dg a_q\dg a_s a_r  ] - N[ \fctr{a_p\dg }{x}{{}_2 }{x} a_p\dg a_q\dg  a_r  a_s ] \\
= - & \fctr{}{x}{{}_1 }{x} a_p\dg  a_s N[  a_q\dg a_r  ] + \fctr{}{x}{{}_1 }{x} a_p\dg a_r N[  a_q\dg a_s   ] 
+ \fctr{ }{x}{{}_2}{x} a_q\dg a_s N[  a_p\dg  a_r  ] -\fctr{ }{x}{{}_2 }{x}a_q\dg  a_r N[  a_p\dg   a_s ] \\
=  - & \gamma_{ps} N[  a_q\dg a_r  ] + \gamma_{pr} N[  a_q\dg a_s   ] 
+ \gamma_{qs}  N[  a_p\dg  a_r  ] -\gamma_{qr}  N[  a_p\dg   a_s ] \\
\end{align*}
We can equivalently keep the contraction lines fixed and permute the operators instead. 
For the terms with single contractions, instead of moving the contraction lines, we can keep them at positions 1 and 3, and permute the operators to get the equivalent contractions: 
\begin{align*}
&N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg a_q\dg a_s a_r  ] + N[ \fctr{}{x}{{}_1a_q\dg  a_s }{x} a_p\dg a_q\dg a_s a_r  ] 
+ N[ \fctr{a_p\dg }{x}{{}_2}{x} a_p\dg a_q\dg a_s a_r  ] +  N[ \fctr{a_p\dg }{x}{{}_2 a_s }{x} a_p\dg a_q\dg a_s a_r  ] \\ 
= & N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg a_q\dg a_s a_r  ] - N[ \fctr{}{x}{{}_1a_q\dg  }{x} a_p\dg a_q\dg a_r  a_s  ] 
- N[ \fctr{ }{x}{{}_q\dg a_p\dg }{x} a_q\dg  a_p\dg a_s a_r  ] +  N[ \fctr{ }{x}{{}_q\dg a_p\dg }{x} a_q\dg a_p\dg  a_r a_s   ] \\ 
\end{align*}
We see that the second term can obtained by permuting indices $s$ and $r$, the third term is obtained by permuting indices $p$ and $q$, and the fourth term is obtained 
by permuting both $p$ and $q$,  and $s$ and $r$. The sign change of a permutation is accounted for. 
\\ \\
How can we compactly represent permutation on indices? 
\\ \\
Recall that we previous introduced the index antisymmetrizer operator $\hat{A}$ when we defined a Slater Determinant $\Phi$: 
 \[ \ket{\Phi_{p_1 \cdots p_N}} =  \sqrt{N!} \hat{A} \ket{\phi_{p_1}\phi_{p_2} \cdots \phi_{p_N}} \]
The antisymmetrizer $\hat{A}$ gave us a linear combination of all possible permutations of indices $p_1 \cd p_N$. 
Here, we want a similar type of operator, one that gives us a linear combination of index permutations. 
Instead of $\hat{A}$, which gave us \textit{all} possible permutations for a set of indices, we want an operator that only acts on a subset of these indices. \\ \\
We can define a \textit{reduced index antisymmetrizer} $\hat{P}_{(r_1 / \cd / r_m)}$, which gives all possible permutations between indices $r_1 \cd  r_m$, where 
$r_1 \cd  r_m$ is a subset of some larger set of indices $p_1 \cd p_N$. 
We note the $/$ defines the subgroups of indices. 
We only consider permutations \textit{between} the subgroups. 
Let's go through some examples. 
\subsection{$\hat{P}_{(p/q)}$}
$\hat{P}_{(p/q)}$ gives us the linear combinations of all permutations of $p$ and $q$. 
We can express it as: 
\[\hat{P}_{(p/q)} = 1 - (pq) \]
$(pq)$ represents a transposition between indices $p$ and $q$, and has a negative sign to account for the permutation. 
We can see the result of acting $\hat{P}$ on a product of operators: 
\[\hat{P}_{(p/q)} a_p a_q = [1 - (pq) ] a_p a_q = a_p a_q - a_q a_p \]
\[\hat{P}_{(p/q)} a_p a_r a_q = [1 - (pq) ] a_p a_r a_q = a_p a_r a_q - a_q a_r a_p \]
%(Side note: If $r_1 \cd  r_m$ is exactly equal to $p_1 \cd p_N$, then $\hat{P}$ is equal to $\hat{A}$. 
\\ \\
The total number of terms in the linear combination is obtained by:
\[\frac{2!}{1! 1!} = 2 \]
where the numerator is the factorial of the total number of indices involved ($p$, $q$) 
and the denominator is the factorial of the total number of indices in \textit{each subgroup} divided by $/$. 
\subsection{$\hat{P}_{(p/q/r)}$}
$\hat{P}_{(p/q)}$ gives us the linear combinations of all permutations between $p$, $q$, and $r$: 
 \[\hat{P}_{(p/q/r)} = 1 - (pq) - (pr) - (qr) + (qr)(pr) + (pq)(qr) \]
 To see the how to obtain the transpositions above, we can write down all possible ways to order $p$, $q$, and $r$ and the associated permutations: 
 \begin{align*}
pqr \quad& (1)  \\
 prq \quad& (qr) \\
rqp \quad& (pr)  \\
rpq \quad& (qr)(pr) \\
qpr \quad& (pq) \\
qrp  \quad& (qr)(pr)
 \end{align*}
 Without writing all the permutations explicitly, we can obtain the total number terms in the linear combination with:
 \[\frac{3!}{1! 1! 1!} = 6 \]
\subsection{$\hat{P}_{(p/qr)}$}
Remember that we consider permutations between subgroups divided by $/$. 
Thus, for the operator $\hat{P}_{(p/qr)}$, we consider permutations between $p$ and $q$, and $p$ and $r$, but NOT $q$ and $r$: 
 \[\hat{P}_{(p/qr)} = 1 - (pq) - (qr)  \]
 The total number of terms in the linear combination is: 
 \[\frac{3!}{1! 2!} = 3 \]
 You can prove to yourself that we can recover all permutations between $p$, $q$, and $r$ by multiplying  $\hat{P}_{(p/qr)}$ by the permutations we didn't consider $ \left( \hat{P}_{(q/r)}\right)$:
 \[ \hat{P}_{(p/q/r)} = \hat{P}_{(p/qr)}\hat{P}_{(q/r)}\]
 \subsection{Using the reduced index antisymmetrizer for contractions}
 We see that the permutations associated with the single contractions that we wrote before: 
 \begin{align*}
 & N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg  a_q\dg a_s a_r  ] - N[ \fctr{}{x}{{}_1a_q\dg  }{x} a_p\dg a_q\dg a_r  a_s  ] 
- N[ \fctr{ }{x}{{}_q\dg a_p\dg }{x} a_q\dg  a_p\dg a_s a_r  ] +  N[ \fctr{ }{x}{{}_q\dg a_p\dg }{x} a_q\dg a_p\dg  a_r a_s   ] \\ 
& \quad \quad (1)  \quad \quad  \quad \quad \quad (rs) \quad \quad  \quad \quad \quad (pq) \quad \quad  \quad \quad (pq)(rs) 
\end{align*}
is simply a product of 2 independent permutations $\hat{P}_{(p/q)}$ and $\hat{P}_{(s/r)}$:
\[ \hat{P}_{(p/q)}\hat{P}_{(s/r)} = 1 - (pq) - (sr) + (pq)(sr) \]
We can thus represent the four single contractions with just the index antisymmetrizer acting on one term: 
\[ \hat{P}_{(p/q)}\hat{P}_{(s/r)} N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg  a_q\dg a_s a_r  ]  = N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg  a_q\dg a_s a_r  ] - N[ \fctr{}{x}{{}_1a_q\dg  }{x} a_p\dg a_q\dg a_r  a_s  ] 
- N[ \fctr{ }{x}{{}_q\dg a_p\dg }{x} a_q\dg  a_p\dg a_s a_r  ] +  N[ \fctr{ }{x}{{}_q\dg a_p\dg }{x} a_q\dg a_p\dg  a_r a_s   ]  \] 
We can represent the double contractions in a similar manner: 
\[ \hat{P}_{(s/r)}  N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x}      a_p\dg a_q\dg a_s a_r  ]  =  N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x}      a_p\dg a_q\dg a_s a_r  ] 
 - N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x}      a_p\dg a_q\dg a_r a_s  ] = N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x}      a_p\dg a_q\dg a_s a_r  ] 
+ N[ \fctr{}{x}{{}_1a_q\dg }{x}  \fctr[2ex]{a_p\dg }{x}{{}_2 a_s }{x} a_p\dg a_q\dg a_s a_r  ] \]
Note that instead of permuting $s$ and $r$, we can alternatively permute $p$ and $q$ for the same result. 
\\ \\
Thus, using index antisymmetrizers, we can represent the full Wick expansion of $a_p\dg  a_q\dg a_s a_r $ as: 
\[a_p\dg  a_q\dg a_s a_r = N[a_p\dg  a_q\dg a_s a_r] + \hat{P}_{(p/q)}\hat{P}_{(s/r)} N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg  a_q\dg a_s a_r  ]  + \hat{P}_{(s/r)}  N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x}      a_p\dg a_q\dg a_s a_r  ]   \]
This is already a huge improvement for simplifying our notation. 
\section{Kutzelnigg--Mukherjee Notation}
We can further simplify our notation by changing how we write creation and annihilation operators.
Under the Kutzelnigg--Mukherjee notation, we write creation operators as: 
\[a_p\dg = a^p\]
Thus, a product $a_p a_q\dg$ can be written as $a_p a^q$. 
\\ \\
A vacuum normal ordered string of operators, 
\[a^{p_1} \cd a^{p_m} a_{q_m} \cd a_{q_1} \] 
can be further compactly represented by combining the upper and lower indices: 
\[a^{p_1} \cd a^{p_m} a_{q_m} \cd a_{q_1} = a^{p_1 \cd p_m}_{q_1 \cd q_m} \] 
For example, 
\[a^p a_q = a^p_q\]
\[a^{pq}_{rs} = a^pa^qa_sa_r\]
\\ 
$\Phi$-Normal ordered operators \textit{in which the string inside is in vacuum normal ordering }can be written as: 
\[ \tilde{a}^{p_1 \cd p_m}_{q_1 \cd q_m}  = N[ a^{p_1} \cd a^{p_m} a_{q_m} \cd a_{q_1}  ] \]
For example, product of 2 operators $a^pa_q$ in $\Phi$-normal ordering is: 
\[\tilde{a}^p_q = N[a^pa_q]\]
Note that if the order of the operators were switched, and we had $a^pa_q$, we cannot simplify $N[a_p a^q]$ any further because the more compact notation only applies to terms in which 
the dagger is on the left.\footnote{Technically, you could write, $N[a_p a^q] = - N[ a^q a_p] = - \tilde{a}^p_q$. But be very careful. 
This kind of free permutation is only allowed when there are no contractions involved. 
Remember that you \textit{cannot} freely permute the order of \textit{contracted} operators. } 
\\ \\ 
How would we simplify $N[a^p a_q a^s a_r ] $? In this case, there are two groups of operators that are in $vacuum$ normal ordering. 
We can write $a_q^p = a^p a_q$ and $a_r^s = a^s a_r$. 
Our final simplification is: 
\[N[a^p a_q a^s a_r ] = N[ a_q^p a_r^s ] \] 
%\[ N[ a_p\dg a_q a_\]
 
\subsection{1 and 2-electron integrals}
The one and two-electron integrals can also be represented by using upper and lower indices.
The indices in the $bra$ will be written as lower indices. 
The indices in the $ket$ will be written as upper indices. 
\\ \\
We thus have: 
\[\braket{p | \hat{h}| q} = h_{pq} = h_p^q \]
\[\braket{p | \hat{h}| q} + \sum_i \braket{pi || qi} = f_{pq} = f_p^q \]
We using $g$ for the two-electron integrals:
\[\braket{pq| \hat{\nu} | rs} = \braket{pq| rs} =g_{pq}^{rs} \]
The antisymmetrized two-electron integral can be represented with $\bar{g}$: 
\[\braket{pq| rs}  - \braket{pq| sr} = \braket{pq|| rs} =\bar{g}_{pq}^{rs} \]
We can thus express our Hamiltonian as: 
\[ H = \sum_{pq} h_{pq} \apd a_q + \frac{1}{2} \sum_{pqrs} \braket{pq|rs} \apd a_q\dg a_s a_r  = \sum_{pq} h_{p}^{q} a_q^p + \frac{1}{2} \sum_{pqrs} g_{pq}^{rs} a^{pq}_{rs}  \] 
We can take advantage of the Einstein summation notation, which says that if an index appears once as an upper index and once as a lower index, it is \textit{implicitly} summed over. 
Since $p$, $q$, $r$, and $s$ appear both as a upper and lower index, we can leave out the implicit summation: 
\[ H  =  h_{p}^{q} a_q^p +  \frac{1}{2} g_{pq}^{rs} a^{pq}_{rs} \]
The antisymmetrized Hamiltonian can be written as: 
\[ H  = h_{pq} a_q^p +  \frac{1}{4} \bar{g}_{pq}^{rs} a^{pq}_{rs} \]
The correlation component of the Hamiltonian can be written as: 
\[ H_c  = \sum_{pq}f_{pq} N[\apd a_q  ] +  \frac{1}{4}\sum_{pqrs}  \braket{pq||rs}  N[\apd a_q\dg a_s a_r] =   f_{p}^{q} \tilde{a}_q^p +  \frac{1}{4} \bar{g}_{pq}^{rs} \tilde{a}^{pq}_{rs} \]
Note the use of $\tilde{a}$ in $H_c$. 
\subsection{Contractions} 
In the particle-hole formalism, we had 2 types of contractions: 
\[\fctr{ }{a}{{}_p\dg}{a} a_p\dg a_q = \gamma_{pq} \quad \quad \fctr{ }{a}{{}_p}{a} a_p a_q\dg = \eta_{pq} \]
\[\fctr{ }{a}{{}^p}{a} a^p a_q = \gamma_{pq} \quad \quad \fctr{ }{a}{{}_p}{a} a_p a^q = \eta_{pq} \]
$\fctr{ }{a}{{}^p}{a} a^p a_q$ were contractions that only existed when we switched to the hole framework. 
Thus, we call these types of contractions \textit{hole contractions}. 
We call $\fctr{ }{a}{{}_p}{a} a_p a^q $ \textit{particle contractions} since they existed in the original particle framework.  \\ \\
We represent hole contractions with open circles: 
\[ \fctr{ }{a}{{}^p}{a}a^p a_q  = a^{p^\circ} a_{q^\circ} = a^{p^\circ}_{q^\circ} = \gamma_{pq} \]
We see that since the creation operator is on the left, we can use the more compact notation for hole contractions. 
We represent particle contractions with closed circles: 
\[ \fctr{ }{a}{{}_p}{a} a_p a^q  = a_{p^\bullet} a^{q^\bullet}  =  \eta_{pq} \]

\subsection{Example 1}
We can now write our Wick expansion of 4 operators using KM notation, going from
\[a_p\dg  a_q\dg a_s a_r = N[a_p\dg  a_q\dg a_s a_r] + \hat{P}_{(p/q)}\hat{P}_{(s/r)} N[ \fctr{}{x}{{}_1a_q\dg }{x} a_p\dg  a_q\dg a_s a_r  ]  + \hat{P}_{(s/r)}  N[ \fctr{a_p\dg }{x}{{}_2}{x} \fctr[2ex]{}{x}{{}_1a_q\dg  a_s }{x} a_p\dg a_q\dg a_s a_r  ]   \]
to
\[a_{rs}^{pq} = \tl{a}_{rs}^{pq} +  \hat{P}^{(p/q)}_{(s/r)}  \tl{a}_{r s^\h}^{p^\h q}  + \hat{P}_{(s/r)}  \tl{a}_{r^{\h} s^{\h\h}}^{p^\h q^{\h\h}} \] 
Notice that to distinguish between different contraction pairs, I chose to use a different number of open circles. 
\subsection{Example 2 } 
Let's see an example of an instance where particle contractions come up: 
\[ \braket{\Phi_j^b | H_c | \Phi_i^a} =  f_p^q \braket{\Phi | \tl{a}_b^j \tl{a}_q^p \tl{a}_i^a | \Phi} + \frac{1}{2}g_{pq}^{rs} \braket{\Phi | \tl{a}_b^j \tl{a}^{pq}_{rs} \tl{a}_i^a | \Phi}   \]
For the one-electron term, we see that we can form 2 fully contracted terms:
\[ f_p^q \braket{\Phi | \tl{a}_b^j \tl{a}_q^p \tl{a}_i^a | \Phi}  = f_p^q \braket{\Phi | \tl{a}_{b^\p}^{j^{\h\h}} \tl{a}_{q^{\h\h}}^{p^\h} \tl{a}_{i^\h}^{a^\p} | \Phi}  + f_p^q \braket{\Phi | \tl{a}_{b^\p}^{j^\h} \tl{a}_{q^{\p\p}}^{p^\p} \tl{a}_{i^\h}^{a^{\p\p}} | \Phi} \]
For the two-electron term, we see that all possible fully contracted terms involves permutations between $p$ and $q$, and $r$ and $s$, so we can just use a reduced index antisymmetrizer:
\[ \frac{1}{2}g_{pq}^{rs} \braket{\Phi | \tl{a}_b^j \tl{a}^{pq}_{rs} \tl{a}_i^a | \Phi} = \frac{1}{2}g_{pq}^{rs}  \hat{P}^{(p/q)}_{(r/s)}  \braket{\Phi | \tl{a}_{b^\p}^{j^{\h\h}} \tl{a}^{{p^\h}{q^\p}}_{{r^{\p\p}}{s^{\h\h}}} \tl{a}_{i^\h}^{a^{\p\p}} | \Phi}  \]
To actually evaluate the term, in my opinion, it is not easy to see the overall sign that the contractions give until you translate back to writing contraction lines. 
\subsection{Last thoughts}
Some last observations:
\begin{itemize}
\item Contractions are always between upper and lower indices. This is because the nonzero contractions are always between creation (upper indices) and annihilation operators (lower indices).
\item Within a group that can be compacted written with one $a$, for example, $\tl{a}^{p_1 \cd p_m}_{q_1 \cd q_m} $, only hole contractions are possible, since by definition all the dagger on the left.
 \item We can use reduced index antisymmetrizers only between indices that are part of the $same$ $\Phi$-normal ordered group, since you can only freely permute with a sign change within a $\Phi$-normal ordered group. 
\end{itemize}
\end{document}
